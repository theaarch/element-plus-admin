import{f as e}from"./aria.Cpd_B0tV.js";import{o as t,aa as n,r as o,H as s,K as a,L as r,_ as u,d as c,l as d,I as i,i as l,N as f,U as v,M as p,y as m,t as E,z as y,e as L,f as w,aO as b,q as h}from"./index.B90-c5zJ.js";const T="focus-trap.focus-after-trapped",g="focus-trap.focus-after-released",k={cancelable:!0,bubbles:!1},F={cancelable:!0,bubbles:!1},R="focusAfterTrapped",K="focusAfterReleased",N=Symbol("elFocusTrap"),S=o(),_=o(0),P=o(0);let I=0;const C=e=>{const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{const t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0||e===document.activeElement?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t},O=(e,t)=>{for(const n of e)if(!j(n,t))return n},j=(e,t)=>{if("hidden"===getComputedStyle(e).visibility)return!0;for(;e;){if(t&&e===t)return!1;if("none"===getComputedStyle(e).display)return!0;e=e.parentElement}return!1},x=(t,n)=>{if(t){const o=document.activeElement;e(t,{preventScroll:!0}),P.value=window.performance.now(),t!==o&&(e=>e instanceof HTMLInputElement&&"select"in e)(t)&&n&&t.select()}};function A(e,t){const n=[...e],o=e.indexOf(t);return-1!==o&&n.splice(o,1),n}const q=(()=>{let e=[];return{push:t=>{const n=e[0];n&&t!==n&&n.pause(),e=A(e,t),e.unshift(t)},remove:t=>{var n,o;e=A(e,t),null==(o=null==(n=e[0])?void 0:n.resume)||o.call(n)}}})(),B=()=>{S.value="pointer",_.value=window.performance.now()},D=()=>{S.value="keyboard",_.value=window.performance.now()},H=e=>new CustomEvent("focus-trap.focusout-prevented",{...F,detail:e});let M=[];const U=e=>{a(e)===r.esc&&M.forEach(t=>t(e))};var $=u(c({name:"ElFocusTrap",inheritAttrs:!1,props:{loop:Boolean,trapped:Boolean,focusTrapEl:Object,focusStartEl:{type:[Object,String],default:"first"}},emits:[R,K,"focusin","focusout","focusout-prevented","release-requested"],setup(e,{emit:u}){const c=o();let d,E;const{focusReason:y}=(t(()=>{0===I&&(document.addEventListener("mousedown",B),document.addEventListener("touchstart",B),document.addEventListener("keydown",D)),I++}),n(()=>{I--,I<=0&&(document.removeEventListener("mousedown",B),document.removeEventListener("touchstart",B),document.removeEventListener("keydown",D))}),{focusReason:S,lastUserFocusTimestamp:_,lastAutomatedFocusTimestamp:P});var L;L=t=>{e.trapped&&!w.paused&&u("release-requested",t)},t(()=>{0===M.length&&document.addEventListener("keydown",U),s&&M.push(L)}),n(()=>{M=M.filter(e=>e!==L),0===M.length&&s&&document.removeEventListener("keydown",U)});const w={paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}},b=t=>{if(!e.loop&&!e.trapped)return;if(w.paused)return;const{altKey:n,ctrlKey:o,metaKey:s,currentTarget:c,shiftKey:d}=t,{loop:i}=e,l=a(t)===r.tab&&!n&&!o&&!s,f=document.activeElement;if(l&&f){const e=c,[n,o]=(e=>{const t=C(e);return[O(t,e),O(t.reverse(),e)]})(e);if(n&&o)if(d||f!==o){if(d&&[n,e].includes(f)){const e=H({focusReason:y.value});u("focusout-prevented",e),e.defaultPrevented||(t.preventDefault(),i&&x(o,!0))}}else{const e=H({focusReason:y.value});u("focusout-prevented",e),e.defaultPrevented||(t.preventDefault(),i&&x(n,!0))}else if(f===e){const e=H({focusReason:y.value});u("focusout-prevented",e),e.defaultPrevented||t.preventDefault()}}};m(N,{focusTrapRef:c,onKeydown:b}),i(()=>e.focusTrapEl,e=>{e&&(c.value=e)},{immediate:!0}),i([c],([e],[t])=>{e&&(e.addEventListener("keydown",b),e.addEventListener("focusin",j),e.addEventListener("focusout",A)),t&&(t.removeEventListener("keydown",b),t.removeEventListener("focusin",j),t.removeEventListener("focusout",A))});const h=e=>{u(R,e)},F=e=>u(K,e),j=t=>{const n=l(c);if(!n)return;const o=t.target,s=t.relatedTarget,a=o&&n.contains(o);if(!e.trapped){s&&n.contains(s)||(d=s)}a&&u("focusin",t),w.paused||e.trapped&&(a?E=o:x(E,!0))},A=t=>{const n=l(c);if(!w.paused&&n)if(e.trapped){const o=t.relatedTarget;f(o)||n.contains(o)||setTimeout(()=>{if(!w.paused&&e.trapped){const e=H({focusReason:y.value});u("focusout-prevented",e),e.defaultPrevented||x(E,!0)}},0)}else{const e=t.target;e&&n.contains(e)||u("focusout",t)}};async function $(){await v();const t=l(c);if(t){q.push(w);const n=t.contains(document.activeElement)?d:document.activeElement;d=n;if(!t.contains(n)){const o=new Event(T,k);t.addEventListener(T,h),t.dispatchEvent(o),o.defaultPrevented||v(()=>{let o=e.focusStartEl;p(o)||(x(o),document.activeElement!==o&&(o="first")),"first"===o&&((e,t=!1)=>{const n=document.activeElement;for(const o of e)if(x(o,t),document.activeElement!==n)return})(C(t),!0),document.activeElement!==n&&"container"!==o||x(t)})}}}function W(){const e=l(c);if(e){e.removeEventListener(T,h);const t=new CustomEvent(g,{...k,detail:{focusReason:y.value}});e.addEventListener(g,F),e.dispatchEvent(t),t.defaultPrevented||"keyboard"!=y.value&&_.value>P.value&&!e.contains(document.activeElement)||x(null!=d?d:document.body),e.removeEventListener(g,F),q.remove(w),d=null,E=null}}return t(()=>{e.trapped&&$(),i(()=>e.trapped,e=>{e?$():W()})}),n(()=>{e.trapped&&W(),c.value&&(c.value.removeEventListener("keydown",b),c.value.removeEventListener("focusin",j),c.value.removeEventListener("focusout",A),c.value=void 0)}),{onKeydown:b}}}),[["render",function(e,t,n,o,s,a){return d(e.$slots,"default",{handleKeydown:e.onKeydown})}],["__file","focus-trap.vue"]]);const W=E({to:{type:y([String,Object]),required:!0},disabled:Boolean});const z=h(u(c({__name:"teleport",props:W,setup:e=>(e,t)=>e.disabled?d(e.$slots,"default",{key:0}):(w(),L(b,{key:1,to:e.to},[d(e.$slots,"default")],8,["to"]))}),[["__file","teleport.vue"]]));export{$ as E,N as F,z as a,W as t};
