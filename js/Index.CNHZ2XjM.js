import{d as e,ak as a,r as l,S as t,c as o,aq as i,I as s,o as r,ar as n,g as d,f as u,C as m,m as p,w as c,a3 as f,i as v,a4 as b,$ as j,e as g,h as _,az as h,F as y,E as k,bk as x}from"./index.B9DDwXyn.js";import{v as V}from"./loading.DgVxatZq.js";import{E as w}from"./tree.hG9d5X2A.js";import{E as C}from"./checkbox.PfgpXjIm.js";import"./text.dsXhSvF4.js";/* empty css                */import{E}from"./popper.tjIFXnGm.js";import{E as S}from"./overlay.CaF_iYQP.js";import{E as U}from"./input.h3oSW7Fu.js";import{E as z}from"./input-number.Cq0380tO.js";import{E as R,a as F}from"./radio-group.xG2HYvqK.js";/* empty css            */import{E as N,a as q}from"./select.DXDT8lei.js";import"./scrollbar.Bhy-xkQk.js";import{E as T}from"./card.BXy-Ncik.js";import{_ as I}from"./index.DgXs3aUv.js";import{a as O,E as B}from"./table-column.HahAEEQU.js";import{E as A,a as D}from"./form-item.D3h4sxEF.js";/* empty css               */import{R as K}from"./role-api.C8x4IH5G.js";/* empty css                *//* empty css                    */import{E as M}from"./index.C4LHJRvW.js";import{E as P}from"./index.FlroawDi.js";import{E as X}from"./index.BJydFClc.js";import{E as Y}from"./index.DN4bf5hU.js";import"./token.DWNpOE8r.js";import"./index.DrJPKNhY.js";import"./use-form-common-props.Cfh8sL7v.js";import"./index.DBPJmu1s.js";import"./event.BwRzfsZt.js";import"./error.D_Dr4eZ1.js";import"./index.BpkllUJ0.js";import"./index.DI7Lq47c.js";import"./aria.Cpd_B0tV.js";import"./index.C8Gfv6TL.js";import"./vnode.BymF0sgh.js";import"./refs.Cw5r5QN8.js";import"./scroll.iVt-7v8H.js";import"./typescript.CRqm1_SZ.js";import"./index.CMoYSvzR.js";import"./index.-MvgtnPj.js";import"./index.Cxq1v0nf.js";import"./strings.DxzcQhMs.js";import"./castArray.CurgOZrE.js";import"./debounce.DpZxVawV.js";import"./toNumber.BgQEYUe1.js";import"./_baseIteratee.D7y0cmdm.js";import"./index.Csx3iWGu.js";import"./pagination.BAmVJ6nm.js";import"./_plugin-vue_export-helper.BCo6x5W8.js";import"./_initCloneObject.G0Dih7LI.js";import"./raf.BPqLmvY8.js";import"./_baseClone.O-Y6IxeR.js";const $={class:"app-container"},Q={class:"search-container"},W={class:"data-table__toolbar"},Z={class:"data-table__toolbar--actions"},G={class:"dialog-footer"},H={class:"flex-x-between"},J={class:"flex-center ml-5"},L={class:"dialog-footer"},ee=e({name:"Role",inheritAttrs:!1,__name:"Index",setup(e){const ee=a(),ae=l(),le=l(),te=l(),oe=l(!1),ie=l([]),se=l(0),re=t({pageNum:1,pageSize:10}),ne=l(),de=l([]),ue=t({title:"",visible:!1}),me=o(()=>ee.device===i.DESKTOP?"600px":"90%"),pe=t({sort:1,status:1}),ce=t({name:[{required:!0,message:"请输入角色名称",trigger:"blur"}],code:[{required:!0,message:"请输入角色编码",trigger:"blur"}],dataScope:[{required:!0,message:"请选择数据权限",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"blur"}]}),fe=l({}),ve=l(!1),be=l(""),je=l(!0),ge=l(!0);function _e(){oe.value=!0,K.getPage(re).then(e=>{ne.value=e.list,se.value=e.total}).finally(()=>{oe.value=!1})}function he(){re.pageNum=1,_e()}function ye(){ae.value.resetFields(),re.pageNum=1,_e()}function ke(e){ie.value=e.map(e=>e.id)}function xe(e){ue.visible=!0,e?(ue.title="修改角色",K.getFormData(e).then(e=>{Object.assign(pe,e)})):ue.title="新增角色"}function Ve(){le.value.validate(e=>{if(e){oe.value=!0;const e=pe.id;e?K.update(e,pe).then(()=>{X.success("修改成功"),we(),ye()}).finally(()=>oe.value=!1):K.create(pe).then(()=>{X.success("新增成功"),we(),ye()}).finally(()=>oe.value=!1)}})}function we(){ue.visible=!1,le.value.resetFields(),le.value.clearValidate(),pe.id=void 0,pe.sort=1,pe.status=1}function Ce(e){const a=[e||ie.value].join(",");a?Y.confirm("确认删除已选中的数据项?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{oe.value=!0,K.deleteByIds(a).then(()=>{X.success("删除成功"),ye()}).finally(()=>oe.value=!1)},()=>{X.info("已取消删除")}):X.warning("请勾选删除项")}function Ee(){const e=fe.value.id;if(e){const a=te.value.getCheckedNodes(!1,!0).map(e=>e.value);oe.value=!0,K.updateRoleMenus(e,a).then(()=>{X.success("分配权限成功"),ve.value=!1,ye()}).finally(()=>{oe.value=!1})}}function Se(){je.value=!je.value,te.value&&Object.values(te.value.store.nodesMap).forEach(e=>{je.value?e.expand():e.collapse()})}function Ue(e,a){return!e||a.label.includes(e)}function ze(e){ge.value=e}return s(be,e=>{te.value.filter(e)}),r(()=>{he()}),(e,a)=>{const l=U,t=A,o=M,i=D,s=B,r=P,X=O,Y=I,ee=T,Re=q,Fe=N,Ne=F,qe=R,Te=z,Ie=S,Oe=n("Search"),Be=n("Switch"),Ae=C,De=n("QuestionFilled"),Ke=k,Me=E,Pe=w,Xe=V;return u(),d("div",$,[m("div",Q,[p(i,{ref_key:"queryFormRef",ref:ae,model:v(re),inline:!0},{default:c(()=>[p(t,{prop:"keywords",label:"关键字"},{default:c(()=>[p(l,{modelValue:v(re).keywords,"onUpdate:modelValue":a[0]||(a[0]=e=>v(re).keywords=e),placeholder:"角色名称",clearable:"",onKeyup:f(he,["enter"])},null,8,["modelValue"])]),_:1}),p(t,{class:"search-buttons"},{default:c(()=>[p(o,{type:"primary",icon:"search",onClick:he},{default:c(()=>[...a[16]||(a[16]=[b("搜索",-1)])]),_:1}),p(o,{icon:"refresh",onClick:ye},{default:c(()=>[...a[17]||(a[17]=[b("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),p(ee,{shadow:"hover",class:"data-table"},{default:c(()=>[m("div",W,[m("div",Z,[p(o,{type:"success",icon:"plus",onClick:a[1]||(a[1]=e=>xe())},{default:c(()=>[...a[18]||(a[18]=[b("新增",-1)])]),_:1}),p(o,{type:"danger",disabled:0===v(ie).length,icon:"delete",onClick:a[2]||(a[2]=e=>Ce())},{default:c(()=>[...a[19]||(a[19]=[b(" 删除 ",-1)])]),_:1},8,["disabled"])])]),j((u(),g(X,{ref:"dataTableRef",data:v(ne),"highlight-current-row":"",border:"",class:"data-table__content",onSelectionChange:ke},{default:c(()=>[p(s,{type:"selection",width:"55",align:"center"}),p(s,{label:"角色名称",prop:"name","min-width":"100"}),p(s,{label:"角色编码",prop:"code",width:"150"}),p(s,{label:"状态",align:"center",width:"100"},{default:c(e=>[1===e.row.status?(u(),g(r,{key:0,type:"success"},{default:c(()=>[...a[20]||(a[20]=[b("正常",-1)])]),_:1})):(u(),g(r,{key:1,type:"info"},{default:c(()=>[...a[21]||(a[21]=[b("禁用",-1)])]),_:1}))]),_:1}),p(s,{label:"排序",align:"center",width:"80",prop:"sort"}),p(s,{fixed:"right",label:"操作",width:"220"},{default:c(e=>[p(o,{type:"primary",size:"small",link:"",icon:"position",onClick:a=>async function(e){const a=e.id;a&&(ve.value=!0,oe.value=!0,fe.value.id=a,fe.value.name=e.name,de.value=await x.getOptions(),K.getRoleMenuIds(a).then(e=>{e.forEach(e=>te.value.setChecked(e,!0,!1))}).finally(()=>{oe.value=!1}))}(e.row)},{default:c(()=>[...a[22]||(a[22]=[b(" 分配权限 ",-1)])]),_:1},8,["onClick"]),p(o,{type:"primary",size:"small",link:"",icon:"edit",onClick:a=>xe(e.row.id)},{default:c(()=>[...a[23]||(a[23]=[b(" 编辑 ",-1)])]),_:1},8,["onClick"]),p(o,{type:"danger",size:"small",link:"",icon:"delete",onClick:a=>Ce(e.row.id)},{default:c(()=>[...a[24]||(a[24]=[b(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Xe,v(oe)]]),v(se)>0?(u(),g(Y,{key:0,total:v(se),"onUpdate:total":a[3]||(a[3]=e=>h(se)?se.value=e:null),page:v(re).pageNum,"onUpdate:page":a[4]||(a[4]=e=>v(re).pageNum=e),limit:v(re).pageSize,"onUpdate:limit":a[5]||(a[5]=e=>v(re).pageSize=e),onPagination:_e},null,8,["total","page","limit"])):_("",!0)]),_:1}),p(Ie,{modelValue:v(ue).visible,"onUpdate:modelValue":a[11]||(a[11]=e=>v(ue).visible=e),title:v(ue).title,width:"500px",onClose:we},{footer:c(()=>[m("div",G,[p(o,{type:"primary",onClick:Ve},{default:c(()=>[...a[27]||(a[27]=[b("确 定",-1)])]),_:1}),p(o,{onClick:we},{default:c(()=>[...a[28]||(a[28]=[b("取 消",-1)])]),_:1})])]),default:c(()=>[p(i,{ref_key:"roleFormRef",ref:le,model:v(pe),rules:v(ce),"label-width":"100px"},{default:c(()=>[p(t,{label:"角色名称",prop:"name"},{default:c(()=>[p(l,{modelValue:v(pe).name,"onUpdate:modelValue":a[6]||(a[6]=e=>v(pe).name=e),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),p(t,{label:"角色编码",prop:"code"},{default:c(()=>[p(l,{modelValue:v(pe).code,"onUpdate:modelValue":a[7]||(a[7]=e=>v(pe).code=e),placeholder:"请输入角色编码"},null,8,["modelValue"])]),_:1}),p(t,{label:"数据权限",prop:"dataScope"},{default:c(()=>[p(Fe,{modelValue:v(pe).dataScope,"onUpdate:modelValue":a[8]||(a[8]=e=>v(pe).dataScope=e)},{default:c(()=>[(u(),g(Re,{key:1,label:"全部数据",value:1})),(u(),g(Re,{key:2,label:"部门及子部门数据",value:2})),(u(),g(Re,{key:3,label:"本部门数据",value:3})),(u(),g(Re,{key:4,label:"本人数据",value:4}))]),_:1},8,["modelValue"])]),_:1}),p(t,{label:"状态",prop:"status"},{default:c(()=>[p(qe,{modelValue:v(pe).status,"onUpdate:modelValue":a[9]||(a[9]=e=>v(pe).status=e)},{default:c(()=>[p(Ne,{value:1},{default:c(()=>[...a[25]||(a[25]=[b("正常",-1)])]),_:1}),p(Ne,{value:0},{default:c(()=>[...a[26]||(a[26]=[b("停用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),p(t,{label:"排序",prop:"sort"},{default:c(()=>[p(Te,{modelValue:v(pe).sort,"onUpdate:modelValue":a[10]||(a[10]=e=>v(pe).sort=e),"controls-position":"right",min:0,style:{width:"100px"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),p(Ie,{modelValue:v(ve),"onUpdate:modelValue":a[15]||(a[15]=e=>h(ve)?ve.value=e:null),title:"【"+v(fe).name+"】权限分配",size:v(me),"align-center":""},{footer:c(()=>[m("div",L,[p(o,{type:"primary",onClick:Ee},{default:c(()=>[...a[31]||(a[31]=[b("确 定",-1)])]),_:1}),p(o,{onClick:a[14]||(a[14]=e=>ve.value=!1)},{default:c(()=>[...a[32]||(a[32]=[b("取 消",-1)])]),_:1})])]),default:c(()=>[m("div",H,[p(l,{modelValue:v(be),"onUpdate:modelValue":a[12]||(a[12]=e=>h(be)?be.value=e:null),clearable:"",class:"w-[150px]",placeholder:"菜单权限名称"},{prefix:c(()=>[p(Oe)]),_:1},8,["modelValue"]),m("div",J,[p(o,{type:"primary",size:"small",plain:"",onClick:Se},{icon:c(()=>[p(Be)]),default:c(()=>[b(" "+y(v(je)?"收缩":"展开"),1)]),_:1}),p(Ae,{modelValue:v(ge),"onUpdate:modelValue":a[13]||(a[13]=e=>h(ge)?ge.value=e:null),class:"ml-5",onChange:ze},{default:c(()=>[...a[29]||(a[29]=[b(" 父子联动 ",-1)])]),_:1},8,["modelValue"]),p(Me,{placement:"bottom"},{content:c(()=>[...a[30]||(a[30]=[b(" 如果只需勾选菜单权限，不需要勾选子菜单或者按钮权限，请关闭父子联动 ",-1)])]),default:c(()=>[p(Ke,{class:"ml-1 color-[--el-color-primary] inline-block cursor-pointer"},{default:c(()=>[p(De)]),_:1})]),_:1})])]),p(Pe,{ref_key:"permTreeRef",ref:te,"node-key":"value","show-checkbox":"",data:v(de),"filter-node-method":Ue,"default-expand-all":!0,"check-strictly":!v(ge),class:"mt-5"},{default:c(({data:e})=>[b(y(e.label),1)]),_:1},8,["data","check-strictly"])]),_:1},8,["modelValue","title","size"])])}}});export{ee as default};
