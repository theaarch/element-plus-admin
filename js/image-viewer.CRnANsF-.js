import{cA as e,a$ as a,t as s,z as t,_ as l,d as o,aQ as n,cE as i,cF as r,x as c,b as u,c1 as d,r as v,cG as f,c as p,bT as m,s as g,I as y,o as b,u as w,e as k,f as x,w as h,m as I,T as z,C,k as S,n as _,i as O,h as N,g as $,l as E,j as L,E as T,a2 as A,P as R,cH as P,a8 as j,a4 as B,F as M,cI as Y,cJ as F,D as X,aS as D,cK as H,cL as K,K as q,L as W,U as Z,q as G,bD as V,c0 as J,H as Q,ad as U,Z as ee,bo as ae,aO as se,aP as te,b$ as le,M as oe,cM as ne,cN as ie,a as re}from"./index.DRPoGZBk.js";import{E as ce,a as ue}from"./index.SISkM0HS.js";import{m as de}from"./typescript.CRqm1_SZ.js";import{d as ve}from"./debounce.DQPPIhOy.js";import{u as fe}from"./index.CQZWqeco.js";import{a as pe}from"./scroll.EvVlGgaK.js";function me(a,s,t){var l=!0,o=!0;if("function"!=typeof a)throw new TypeError("Expected a function");return e(t)&&(l="leading"in t?!!t.leading:l,o="trailing"in t?!!t.trailing:o),ve(a,s,{leading:l,maxWait:s,trailing:o})}const ge=s({urlList:{type:t(Array),default:()=>de([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},scale:{type:Number,default:1},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:Boolean,crossorigin:{type:t(String)}}),ye={close:()=>!0,error:e=>e instanceof Event,switch:e=>a(e),rotate:e=>a(e)},be=o({name:"ElImageViewer"});const we=G(l(o({...be,props:ge,emits:ye,setup(e,{expose:a,emit:s}){var t;const l=e,o={CONTAIN:{name:"contain",icon:n(r)},ORIGINAL:{name:"original",icon:n(i)}};let G,V="";const{t:J}=c(),Q=u("image-viewer"),{nextZIndex:U}=d(),ee=v(),ae=v(),se=f(),te=p(()=>{const{scale:e,minScale:a,maxScale:s}=l;return m(e,a,s)}),le=v(!0),oe=v(!1),ne=v(l.initialIndex),ie=g(o.CONTAIN),re=v({scale:te.value,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),de=v(null!=(t=l.zIndex)?t:U()),ve=p(()=>{const{urlList:e}=l;return e.length<=1}),fe=p(()=>0===ne.value),pe=p(()=>ne.value===l.urlList.length-1),ge=p(()=>l.urlList[ne.value]),ye=p(()=>[Q.e("btn"),Q.e("prev"),Q.is("disabled",!l.infinite&&fe.value)]),be=p(()=>[Q.e("btn"),Q.e("next"),Q.is("disabled",!l.infinite&&pe.value)]),we=p(()=>{const{scale:e,deg:a,offsetX:s,offsetY:t,enableTransition:l}=re.value;let n=s/e,i=t/e;const r=a*Math.PI/180,c=Math.cos(r),u=Math.sin(r);n=n*c+i*u,i=i*c-s/e*u;const d={transform:`scale(${e}) rotate(${a}deg) translate(${n}px, ${i}px)`,transition:l?"transform .3s":""};return ie.value.name===o.CONTAIN.name&&(d.maxWidth=d.maxHeight="100%"),d}),ke=p(()=>`${ne.value+1} / ${l.urlList.length}`);function xe(){se.stop(),null==G||G(),document.body.style.overflow=V,s("close")}function he(){le.value=!1}function Ie(e){oe.value=!0,le.value=!1,s("error",e),e.target.alt=J("el.image.error")}function ze(e){if(le.value||0!==e.button||!ee.value)return;re.value.enableTransition=!1;const{offsetX:a,offsetY:s}=re.value,t=e.pageX,l=e.pageY,o=me(e=>{re.value={...re.value,offsetX:a+e.pageX-t,offsetY:s+e.pageY-l}}),n=w(document,"mousemove",o);w(document,"mouseup",()=>{n()}),e.preventDefault()}function Ce(){re.value={scale:te.value,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function Se(){if(le.value||oe.value)return;const e=K(o),a=Object.values(o),s=ie.value.name,t=(a.findIndex(e=>e.name===s)+1)%e.length;ie.value=o[e[t]],Ce()}function _e(e){oe.value=!1;const a=l.urlList.length;ne.value=(e+a)%a}function Oe(){fe.value&&!l.infinite||_e(ne.value-1)}function Ne(){pe.value&&!l.infinite||_e(ne.value+1)}function $e(e,a={}){if(le.value||oe.value)return;const{minScale:t,maxScale:o}=l,{zoomRate:n,rotateDeg:i,enableTransition:r}={zoomRate:l.zoomRate,rotateDeg:90,enableTransition:!0,...a};switch(e){case"zoomOut":re.value.scale>t&&(re.value.scale=Number.parseFloat((re.value.scale/n).toFixed(3)));break;case"zoomIn":re.value.scale<o&&(re.value.scale=Number.parseFloat((re.value.scale*n).toFixed(3)));break;case"clockwise":re.value.deg+=i,s("rotate",re.value.deg);break;case"anticlockwise":re.value.deg-=i,s("rotate",re.value.deg)}re.value.enableTransition=r}function Ee(e){var a;"pointer"===(null==(a=e.detail)?void 0:a.focusReason)&&e.preventDefault()}function Le(){l.closeOnPressEscape&&xe()}function Te(e){if(e.ctrlKey)return e.deltaY<0||e.deltaY>0?(e.preventDefault(),!1):void 0}return y(()=>te.value,e=>{re.value.scale=e}),y(ge,()=>{Z(()=>{const e=ae.value;(null==e?void 0:e.complete)||(le.value=!0)})}),y(ne,e=>{Ce(),s("switch",e)}),b(()=>{!function(){const e=me(e=>{switch(q(e)){case W.esc:l.closeOnPressEscape&&xe();break;case W.space:Se();break;case W.left:Oe();break;case W.up:$e("zoomIn");break;case W.right:Ne();break;case W.down:$e("zoomOut")}}),a=me(e=>{$e((e.deltaY||e.deltaX)<0?"zoomIn":"zoomOut",{zoomRate:l.zoomRate,enableTransition:!1})});se.run(()=>{w(document,"keydown",e),w(document,"wheel",a)})}(),G=w("wheel",Te,{passive:!1}),V=document.body.style.overflow,document.body.style.overflow="hidden"}),a({setActiveItem:_e}),(e,a)=>(x(),k(O(ue),{to:"body",disabled:!e.teleported},{default:h(()=>[I(z,{name:"viewer-fade",appear:""},{default:h(()=>[C("div",{ref_key:"wrapper",ref:ee,tabindex:-1,class:_(O(Q).e("wrapper")),style:S({zIndex:de.value})},[I(O(ce),{loop:"",trapped:"","focus-trap-el":ee.value,"focus-start-el":"container",onFocusoutPrevented:Ee,onReleaseRequested:Le},{default:h(()=>[C("div",{class:_(O(Q).e("mask")),onClick:L(a=>e.hideOnClickModal&&xe(),["self"])},null,10,["onClick"]),N(" CLOSE "),C("span",{class:_([O(Q).e("btn"),O(Q).e("close")]),onClick:xe},[I(O(T),null,{default:h(()=>[I(O(A))]),_:1})],2),N(" ARROW "),O(ve)?N("v-if",!0):(x(),$(R,{key:0},[C("span",{class:_(O(ye)),onClick:Oe},[I(O(T),null,{default:h(()=>[I(O(P))]),_:1})],2),C("span",{class:_(O(be)),onClick:Ne},[I(O(T),null,{default:h(()=>[I(O(j))]),_:1})],2)],64)),e.$slots.progress||e.showProgress?(x(),$("div",{key:1,class:_([O(Q).e("btn"),O(Q).e("progress")])},[E(e.$slots,"progress",{activeIndex:ne.value,total:e.urlList.length},()=>[B(M(O(ke)),1)])],2)):N("v-if",!0),N(" ACTIONS "),C("div",{class:_([O(Q).e("btn"),O(Q).e("actions")])},[C("div",{class:_(O(Q).e("actions__inner"))},[E(e.$slots,"toolbar",{actions:$e,prev:Oe,next:Ne,reset:Se,activeIndex:ne.value,setActiveItem:_e},()=>[I(O(T),{onClick:e=>$e("zoomOut")},{default:h(()=>[I(O(Y))]),_:1},8,["onClick"]),I(O(T),{onClick:e=>$e("zoomIn")},{default:h(()=>[I(O(F))]),_:1},8,["onClick"]),C("i",{class:_(O(Q).e("actions__divider"))},null,2),I(O(T),{onClick:Se},{default:h(()=>[(x(),k(X(O(ie).icon)))]),_:1}),C("i",{class:_(O(Q).e("actions__divider"))},null,2),I(O(T),{onClick:e=>$e("anticlockwise")},{default:h(()=>[I(O(D))]),_:1},8,["onClick"]),I(O(T),{onClick:e=>$e("clockwise")},{default:h(()=>[I(O(H))]),_:1},8,["onClick"])])],2)],2),N(" CANVAS "),C("div",{class:_(O(Q).e("canvas"))},[oe.value&&e.$slots["viewer-error"]?E(e.$slots,"viewer-error",{key:0,activeIndex:ne.value,src:O(ge)}):(x(),$("img",{ref_key:"imgRef",ref:ae,key:O(ge),src:O(ge),style:S(O(we)),class:_(O(Q).e("img")),crossorigin:e.crossorigin,onLoad:he,onError:Ie,onMousedown:ze},null,46,["src","crossorigin"]))],2),E(e.$slots,"default")]),_:3},8,["focus-trap-el"])],6)]),_:3})]),_:3},8,["disabled"]))}}),[["__file","image-viewer.vue"]])),ke=s({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:t([String,Object])},previewSrcList:{type:t(Array),default:()=>de([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},scale:{type:Number,default:1},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:Boolean,crossorigin:{type:t(String)}}),xe={load:e=>e instanceof Event,error:e=>e instanceof Event,switch:e=>a(e),close:()=>!0,show:()=>!0},he=o({name:"ElImage",inheritAttrs:!1});const Ie=G(l(o({...he,props:ke,emits:xe,setup(e,{expose:a,emit:s}){const t=e,{t:l}=c(),o=u("image"),n=V(),i=p(()=>J(Object.entries(n).filter(([e])=>/^(data-|on[A-Z])/i.test(e)||["id","style"].includes(e)))),r=fe({excludeListeners:!0,excludeKeys:p(()=>Object.keys(i.value))}),d=v(),f=v(!1),m=v(!0),g=v(!1),w=v(),I=v(),z=Q&&"loading"in HTMLImageElement.prototype;let S;const L=p(()=>[o.e("inner"),A.value&&o.e("preview"),m.value&&o.is("loading")]),T=p(()=>{const{fit:e}=t;return Q&&e?{objectFit:e}:{}}),A=p(()=>{const{previewSrcList:e}=t;return U(e)&&e.length>0}),P=p(()=>{const{previewSrcList:e,initialIndex:a}=t;let s=a;return a>e.length-1&&(s=0),s}),j=p(()=>"eager"!==t.loading&&(!z&&"lazy"===t.loading||t.lazy)),B=()=>{Q&&(m.value=!0,f.value=!1,d.value=t.src)};function Y(e){m.value=!1,f.value=!1,s("load",e)}function F(e){m.value=!1,f.value=!0,s("error",e)}const X=re(function(e){e&&(B(),H())},200,!0);async function D(){var e;if(!Q)return;await Z();const{scrollContainer:a}=t;if(le(a))I.value=a;else if(oe(a)&&""!==a)I.value=null!=(e=document.querySelector(a))?e:void 0;else if(w.value){const e=pe(w.value);I.value=ne(e)?void 0:e}const{stop:s}=ie(w,([e])=>{X(e.isIntersecting)},{root:I});S=s}function H(){Q&&X&&(null==S||S(),I.value=void 0,S=void 0)}function K(){A.value&&(g.value=!0,s("show"))}function q(){g.value=!1,s("close")}function W(e){s("switch",e)}return y(()=>t.src,()=>{j.value?(m.value=!0,f.value=!1,H(),D()):B()}),b(()=>{j.value?D():B()}),a({showPreview:K}),(e,a)=>(x(),$("div",ee({ref_key:"container",ref:w},O(i),{class:[O(o).b(),e.$attrs.class]}),[f.value?E(e.$slots,"error",{key:0},()=>[C("div",{class:_(O(o).e("error"))},M(O(l)("el.image.error")),3)]):(x(),$(R,{key:1},[void 0!==d.value?(x(),$("img",ee({key:0},O(r),{src:d.value,loading:e.loading,style:O(T),class:O(L),crossorigin:e.crossorigin,onClick:K,onLoad:Y,onError:F}),null,16,["src","loading","crossorigin"])):N("v-if",!0),m.value?(x(),$("div",{key:1,class:_(O(o).e("wrapper"))},[E(e.$slots,"placeholder",{},()=>[C("div",{class:_(O(o).e("placeholder"))},null,2)])],2)):N("v-if",!0)],64)),O(A)?(x(),$(R,{key:2},[g.value?(x(),k(O(we),{key:0,"z-index":e.zIndex,"initial-index":O(P),infinite:e.infinite,"zoom-rate":e.zoomRate,"min-scale":e.minScale,"max-scale":e.maxScale,"show-progress":e.showProgress,"url-list":e.previewSrcList,scale:e.scale,crossorigin:e.crossorigin,"hide-on-click-modal":e.hideOnClickModal,teleported:e.previewTeleported,"close-on-press-escape":e.closeOnPressEscape,onClose:q,onSwitch:W},ae({toolbar:h(a=>[E(e.$slots,"toolbar",se(te(a)))]),default:h(()=>[e.$slots.viewer?(x(),$("div",{key:0},[E(e.$slots,"viewer")])):N("v-if",!0)]),_:2},[e.$slots.progress?{name:"progress",fn:h(a=>[E(e.$slots,"progress",se(te(a)))])}:void 0,e.$slots["viewer-error"]?{name:"viewer-error",fn:h(a=>[E(e.$slots,"viewer-error",se(te(a)))])}:void 0]),1032,["z-index","initial-index","infinite","zoom-rate","min-scale","max-scale","show-progress","url-list","scale","crossorigin","hide-on-click-modal","teleported","close-on-press-escape"])):N("v-if",!0)],64)):N("v-if",!0)],16))}}),[["__file","image.vue"]]));export{Ie as E,we as a};
