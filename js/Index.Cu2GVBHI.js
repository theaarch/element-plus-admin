import{d as e,aJ as a,al as l,r as t,S as o,c as r,ar as s,o as i,bR as d,g as n,f as p,C as u,m,w as c,a3 as f,i as b,a4 as g,$ as j,e as _,h as v,F as h,aA as y,P as V,Q as x,dK as k,bc as w,aG as C}from"./index.CM47KQtG.js";import{v as U}from"./loading.CxFowczj.js";import{E}from"./drawer.JI_saeGj.js";import"./overlay.BreQExSd.js";import{E as I}from"./switch.CHhtDryP.js";import{_ as R}from"./index.vue_vue_type_script_setup_true_lang.BlKT5Hni.js";/* empty css            */import{E as S,a as z}from"./select.CbuXqiqO.js";import"./scrollbar.DJ9OeN8B.js";import"./popper.Dy7mreVG.js";import"./tree.42EjxIGk.js";import"./checkbox.DwMVycN-.js";import"./text.DEj3NSAD.js";import{E as N}from"./tree-select.Cj_fWOti.js";import{E as B}from"./card.JRjeJkVW.js";import{_ as D}from"./index.DfSWtJFb.js";import{a as O,E as T}from"./table-column.agJiczKe.js";/* empty css                */import{E as q,a as A}from"./form-item.BvU-fErQ.js";/* empty css               */import{E as F}from"./date-picker-panel.MzBxxBl-.js";import{E as L}from"./input.DICT-xuJ.js";import{D as P}from"./dept-api.xJQCRVJ1.js";import{R as Y}from"./role-api.DdK9ZxAB.js";import{_ as K}from"./UserImport.vue_vue_type_script_setup_true_lang.DYbw2qFg.js";/* empty css                    */import{E as M}from"./index.p5pvUZ8p.js";import{E as $}from"./index.DB7b8zJj.js";import{E as J}from"./index.DOFvcLEl.js";import"./index.BkpZJorq.js";import"./aria.Cpd_B0tV.js";import"./index.C-zw5LL5.js";import"./vnode.3FsO1Zr2.js";import"./event.BwRzfsZt.js";import"./error.D_Dr4eZ1.js";import"./scroll.HB0cktN2.js";import"./use-form-common-props.CwNouOR0.js";import"./index.BpEbxuRh.js";/* empty css                       */import"./radio-group.BG5oxu62.js";import"./token.DWNpOE8r.js";import"./strings.CuGzRR0G.js";import"./castArray.DwIa-ddT.js";import"./index.BM1Y5O9s.js";import"./debounce.BSbgIsNH.js";import"./toNumber.CTKVBeqF.js";import"./_baseIteratee.Bz4YUaFH.js";import"./index.ChhW_Tvf.js";import"./index.33C-WVq8.js";import"./index.ChigPKlb.js";import"./pagination.BP_3TcMH.js";import"./_plugin-vue_export-helper.BCo6x5W8.js";import"./_initCloneObject.D6_TlKeT.js";import"./raf.UU1-UmoM.js";import"./_baseClone.C_H9MAg3.js";import"./dayjs.min.DxYre9gl.js";import"./index.Ds1pFW66.js";import"./index.DUp9k36Z.js";import"./alert.BtmlPArq.js";import"./dialog.BtEbwb-q.js";import"./refs.Cw5r5QN8.js";import"./upload.BRlpAPWu.js";import"./progress.BprdBZjS.js";import"./link.X1gyXP5A.js";const Q={class:"app-container"},Z={class:"search-container"},G={class:"data-table__toolbar"},W={class:"data-table__toolbar--actions"},X={class:"data-table__toolbar--tools"},H={class:"dialog-footer"},ee=e({name:"User",inheritAttrs:!1,__name:"Index",setup(e){const ee=a(),ae=l(),le=t(),te=t(),oe=o({pageNum:1,pageSize:10}),re=t(),se=t(0),ie=t(!1),de=o({visible:!1,title:"新增用户"}),ne=r(()=>ae.device===s.DESKTOP?"600px":"90%"),pe=o({status:1}),ue=o({email:[{required:!0,message:"Email不能为空",trigger:"blur"}],name:[{required:!0,message:"用户昵称不能为空",trigger:"blur"}],deptId:[{required:!0,message:"所属部门不能为空",trigger:"blur"}],roleIds:[{required:!0,message:"用户角色不能为空",trigger:"blur"}]}),me=t([]),ce=t(),fe=t(),be=t(!1);async function ge(){ie.value=!0;try{const e=await w.getPage(oe);re.value=e.data,se.value=e.meta.total}finally{ie.value=!1}}function je(){oe.pageNum=1,ge()}function _e(){le.value.resetFields(),oe.pageNum=1,oe.deptId=void 0,oe.createTime=void 0,ge()}function ve(e){me.value=e.map(e=>e.id)}async function he(e){de.visible=!0;const a=await Y.getOptions();fe.value=a.data;const l=await P.getOptions();ce.value=l.data,e?(de.title="修改用户",w.getFormData(e).then(e=>{const a=e.data;Object.assign(pe,{...a})})):de.title="新增用户"}function ye(){de.visible=!1,te.value.resetFields(),te.value.clearValidate(),pe.id=void 0,pe.status=1}const Ve=k(()=>{te.value.validate(e=>{if(e){const e=pe.id;ie.value=!0,e?w.update(e,pe).then(()=>{C.success("修改用户成功"),ye(),_e()}).finally(()=>ie.value=!1):w.create(pe).then(()=>{C.success("新增用户成功"),ye(),_e()}).finally(()=>ie.value=!1)}})},1e3);function xe(e){const a=[e||me.value].join(",");if(!a)return void C.warning("请勾选删除项");const l=ee.userInfo;!function(e,a=[],l){return!!l?.userId&&(!(!e||e.toString()!==l.userId)||!e&&a.length>0&&a.map(String).includes(l.userId))}(e,me.value,l)?J.confirm("确认删除用户?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{ie.value=!0,w.deleteByIds(a).then(()=>{C.success("删除成功"),_e()}).finally(()=>ie.value=!1)},()=>{C.info("已取消删除")}):C.error("不能删除当前登录用户")}function ke(){be.value=!0}function we(){w.export(oe).then(e=>{const a=e.data,l=decodeURI(e.headers["content-disposition"].split(";")[1].split("=")[1]),t=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=utf-8"}),o=window.URL.createObjectURL(t),r=document.createElement("a");r.href=o,r.download=l,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(o)})}return i(()=>{je()}),(e,a)=>{const l=L,t=q,o=z,r=S,s=F,i=M,k=A,P=T,Y=$,ee=O,ae=D,Ce=B,Ue=N,Ee=R,Ie=I,Re=E,Se=d("hasPerm"),ze=U;return p(),n("div",Q,[u("div",Z,[m(k,{ref_key:"queryFormRef",ref:le,model:b(oe),inline:!0,"label-width":"auto"},{default:c(()=>[m(t,{label:"关键字",prop:"keywords"},{default:c(()=>[m(l,{modelValue:b(oe).keywords,"onUpdate:modelValue":a[0]||(a[0]=e=>b(oe).keywords=e),placeholder:"Email/昵称/手机号",clearable:"",onKeyup:f(je,["enter"])},null,8,["modelValue"])]),_:1}),m(t,{label:"状态",prop:"status"},{default:c(()=>[m(r,{modelValue:b(oe).status,"onUpdate:modelValue":a[1]||(a[1]=e=>b(oe).status=e),placeholder:"全部",clearable:"",style:{width:"100px"}},{default:c(()=>[m(o,{label:"正常",value:1}),m(o,{label:"禁用",value:0})]),_:1},8,["modelValue"])]),_:1}),m(t,{label:"创建时间"},{default:c(()=>[m(s,{modelValue:b(oe).created_at,"onUpdate:modelValue":a[2]||(a[2]=e=>b(oe).created_at=e),editable:!1,type:"daterange","range-separator":"~","start-placeholder":"开始时间","end-placeholder":"截止时间","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),m(t,{class:"search-buttons"},{default:c(()=>[m(i,{type:"primary",icon:"search",onClick:je},{default:c(()=>[...a[19]||(a[19]=[g("搜索",-1)])]),_:1}),m(i,{icon:"refresh",onClick:_e},{default:c(()=>[...a[20]||(a[20]=[g("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),m(Ce,{shadow:"hover",class:"data-table"},{default:c(()=>[u("div",G,[u("div",W,[j((p(),_(i,{type:"success",icon:"plus",onClick:a[3]||(a[3]=e=>he())},{default:c(()=>[...a[21]||(a[21]=[g(" 新增 ",-1)])]),_:1})),[[Se,["sys:user:add"]]]),j((p(),_(i,{type:"danger",icon:"delete",disabled:0===b(me).length,onClick:a[4]||(a[4]=e=>xe())},{default:c(()=>[...a[22]||(a[22]=[g(" 删除 ",-1)])]),_:1},8,["disabled"])),[[Se,"sys:user:delete"]])]),u("div",X,[j((p(),_(i,{icon:"upload",onClick:ke},{default:c(()=>[...a[23]||(a[23]=[g(" 导入 ",-1)])]),_:1})),[[Se,"sys:user:import"]]),j((p(),_(i,{icon:"download",onClick:we},{default:c(()=>[...a[24]||(a[24]=[g(" 导出 ",-1)])]),_:1})),[[Se,"sys:user:export"]])])]),j((p(),_(ee,{data:b(re),border:"",stripe:"","highlight-current-row":"",class:"data-table__content",onSelectionChange:ve},{default:c(()=>[m(P,{type:"selection",width:"50",align:"center"}),m(P,{label:"ID",prop:"id"}),m(P,{label:"Email",prop:"email"}),m(P,{label:"Name",align:"center",prop:"name"}),m(P,{label:"Roles",align:"center",prop:"deptName"}),m(P,{label:"Status",align:"center",prop:"status"},{default:c(e=>[m(Y,{type:1==e.row.status?"success":"info"},{default:c(()=>[g(h(1==e.row.status?"正常":"禁用"),1)]),_:2},1032,["type"])]),_:1}),m(P,{label:"Created At",align:"center",prop:"created_at"}),m(P,{label:"Actions",fixed:"right",width:"220"},{default:c(e=>[j((p(),_(i,{type:"primary",icon:"RefreshLeft",size:"small",link:"",onClick:a=>{return l=e.row,void J.prompt("请输入用户【"+l.email+"】的新密码","重置密码",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(({value:e})=>{if(!e||e.length<6)return C.warning("密码至少需要6位字符，请重新输入"),!1;w.resetPassword(l.id,e).then(()=>{C.success("密码重置成功，新密码是："+e)})},()=>{C.info("已取消重置密码")});var l}},{default:c(()=>[...a[25]||(a[25]=[g(" 重置密码 ",-1)])]),_:1},8,["onClick"])),[[Se,"sys:user:reset-password"]]),j((p(),_(i,{type:"primary",icon:"edit",link:"",size:"small",onClick:a=>he(e.row.id)},{default:c(()=>[...a[26]||(a[26]=[g(" 编辑 ",-1)])]),_:1},8,["onClick"])),[[Se,"sys:user:edit"]]),j((p(),_(i,{type:"danger",icon:"delete",link:"",size:"small",onClick:a=>xe(e.row.id)},{default:c(()=>[...a[27]||(a[27]=[g(" 删除 ",-1)])]),_:1},8,["onClick"])),[[Se,"sys:user:delete"]])]),_:1})]),_:1},8,["data"])),[[ze,b(ie)]]),b(se)>0?(p(),_(ae,{key:0,total:b(se),"onUpdate:total":a[5]||(a[5]=e=>y(se)?se.value=e:null),page:b(oe).pageNum,"onUpdate:page":a[6]||(a[6]=e=>b(oe).pageNum=e),limit:b(oe).pageSize,"onUpdate:limit":a[7]||(a[7]=e=>b(oe).pageSize=e),onPagination:ge},null,8,["total","page","limit"])):v("",!0)]),_:1}),m(Re,{modelValue:b(de).visible,"onUpdate:modelValue":a[16]||(a[16]=e=>b(de).visible=e),title:b(de).title,"append-to-body":"",size:b(ne),onClose:ye},{footer:c(()=>[u("div",H,[m(i,{type:"primary",onClick:b(Ve)},{default:c(()=>[...a[28]||(a[28]=[g("确 定",-1)])]),_:1},8,["onClick"]),m(i,{onClick:ye},{default:c(()=>[...a[29]||(a[29]=[g("取 消",-1)])]),_:1})])]),default:c(()=>[m(k,{ref_key:"userFormRef",ref:te,model:b(pe),rules:b(ue),"label-width":"80px"},{default:c(()=>[m(t,{label:"Email",prop:"email"},{default:c(()=>[m(l,{modelValue:b(pe).email,"onUpdate:modelValue":a[8]||(a[8]=e=>b(pe).email=e),readonly:!!b(pe).id,placeholder:"请输入Email"},null,8,["modelValue","readonly"])]),_:1}),m(t,{label:"用户昵称",prop:"name"},{default:c(()=>[m(l,{modelValue:b(pe).name,"onUpdate:modelValue":a[9]||(a[9]=e=>b(pe).name=e),placeholder:"请输入用户昵称"},null,8,["modelValue"])]),_:1}),m(t,{label:"所属部门",prop:"deptId"},{default:c(()=>[m(Ue,{modelValue:b(pe).deptId,"onUpdate:modelValue":a[10]||(a[10]=e=>b(pe).deptId=e),placeholder:"请选择所属部门",data:b(ce),filterable:"","check-strictly":"","render-after-expand":!1},null,8,["modelValue","data"])]),_:1}),m(t,{label:"性别",prop:"gender"},{default:c(()=>[m(Ee,{modelValue:b(pe).gender,"onUpdate:modelValue":a[11]||(a[11]=e=>b(pe).gender=e),code:"gender"},null,8,["modelValue"])]),_:1}),m(t,{label:"角色",prop:"roleIds"},{default:c(()=>[m(r,{modelValue:b(pe).roleIds,"onUpdate:modelValue":a[12]||(a[12]=e=>b(pe).roleIds=e),multiple:"",placeholder:"请选择"},{default:c(()=>[(p(!0),n(V,null,x(b(fe),e=>(p(),_(o,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),m(t,{label:"手机号码",prop:"mobile"},{default:c(()=>[m(l,{modelValue:b(pe).mobile,"onUpdate:modelValue":a[13]||(a[13]=e=>b(pe).mobile=e),placeholder:"请输入手机号码",maxlength:"11"},null,8,["modelValue"])]),_:1}),m(t,{label:"邮箱",prop:"email"},{default:c(()=>[m(l,{modelValue:b(pe).email,"onUpdate:modelValue":a[14]||(a[14]=e=>b(pe).email=e),placeholder:"请输入邮箱",maxlength:"50"},null,8,["modelValue"])]),_:1}),m(t,{label:"状态",prop:"status"},{default:c(()=>[m(Ie,{modelValue:b(pe).status,"onUpdate:modelValue":a[15]||(a[15]=e=>b(pe).status=e),"inline-prompt":"","active-text":"正常","inactive-text":"禁用","active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title","size"]),m(K,{modelValue:b(be),"onUpdate:modelValue":a[17]||(a[17]=e=>y(be)?be.value=e:null),onImportSuccess:a[18]||(a[18]=e=>je())},null,8,["modelValue"])])}}});export{ee as default};
