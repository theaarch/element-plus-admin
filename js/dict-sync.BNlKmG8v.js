import{bU as e,r as a,d as t,c as l,o as s,b1 as o,g as i,f as r,m as n,w as d,a4 as c,C as u,e as m,i as p,az as f,P as v,Q as y,F as b,b3 as _,U as j,bl as g}from"./index.DRPoGZBk.js";import{E as h,a as w}from"./col.7XykCHxG.js";import{E as x,a as k}from"./radio-group.DBQ1zoyi.js";import{E as D}from"./card.QxKCHOda.js";import{E}from"./empty.ioUp-Cma.js";import{a as V,E as C}from"./form-item.BX728IAv.js";/* empty css            */import{E as S,a as I}from"./select.Dg8cxWuu.js";import"./scrollbar.psmrftie.js";import"./popper.BU17CZ-L.js";import{E as Y}from"./input.CQ-26BBh.js";/* empty css               */import{E as W}from"./alert.D5p8h8Z0.js";import{u as U}from"./useStomp.CRsxkQ9Y.js";/* empty css                */import{E as z}from"./index.CjQJJCUT.js";import{E as M}from"./index.CATG-Bau.js";import{E as T}from"./index.CHumVb_u.js";import{_ as H}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./typescript.CRqm1_SZ.js";import"./event.BwRzfsZt.js";import"./use-form-common-props.DsMPcFL7.js";import"./index.C88r2BaC.js";import"./index.F5OfedVa.js";import"./error.D_Dr4eZ1.js";import"./castArray.DubCdOyv.js";import"./_baseClone.CEh0Izpu.js";import"./_initCloneObject.CljjGAhF.js";import"./token.DWNpOE8r.js";import"./strings.aj8LsXir.js";import"./index.cDg2wPYz.js";import"./aria.Cpd_B0tV.js";import"./scroll.EvVlGgaK.js";import"./debounce.DQPPIhOy.js";import"./toNumber.BFSSBEJo.js";import"./_baseIteratee.CeiHmyQH.js";import"./index.CJYjkF3a.js";import"./vnode.BI5jxDcy.js";import"./index.SISkM0HS.js";import"./index.YVQhVyFI.js";import"./index.CQZWqeco.js";let N=null;function O(){return N||(N=function(){const t=e(),{isConnected:l,connect:s,subscribe:o,unsubscribe:i,disconnect:r}=U({reconnectDelay:2e4,connectionTimeout:15e3,useExponentialBackoff:!1,maxReconnectAttempts:3}),n=a([]),d=a(new Set),c=a([]);let u=null;const m=e=>{if(e.body)try{const a=JSON.parse(e.body),l=a.dictCode;if(!l)return;t.removeDictItem(l),c.value.forEach(e=>{try{e(a)}catch(t){}})}catch(a){}};return{isConnected:l,initWebSocket:async()=>{try{return void 0}catch(e){}},closeWebSocket:()=>{u&&(clearTimeout(u),u=null),n.value.forEach(e=>{i(e)}),n.value=[],d.value.clear(),r()},handleDictEvent:m,onDictMessage:e=>(c.value.push(e),()=>{const a=c.value.indexOf(e);-1!==a&&c.value.splice(a,1)})}}()),N}const A={class:"app-container"},F={class:"card-header"},J={class:"flex justify-between items-center"},B={key:0,class:"dict-form"},R={class:"flex justify-between items-center"},X={class:"dict-component-demo"},q={class:"mt-4 pt-3 border-top"},K={class:"text-muted mb-2"},P={class:"text-muted"},Q={class:"flex justify-between items-center"},G={class:"cache-content"},L={class:"cache-data"},Z="gender",$=H(t({__name:"dict-sync",setup(t){const U=e(),H=a(!1),N=a("-"),$=a(null),ee=a(""),ae=O(),te=l(()=>ae.isConnected),le=l(()=>te.value?"已连接":"未连接");let se=null;const oe=l(()=>U.getDictItems(Z).length>0),ie=async()=>{await U.loadDictItems(Z),T.success("字典组件已刷新")},re=async()=>{const e=await g.getDictItemFormData(Z,"1");$.value=e},ne=async()=>{if($.value){H.value=!0;try{await g.updateDictItem(Z,"1",$.value),N.value=_(new Date,"YYYY-MM-DD HH:mm:ss").value,T.success("保存成功，后端将通过WebSocket通知所有客户端")}catch(e){T.error("保存失败")}finally{H.value=!1}}};return s(async()=>{await re(),await U.loadDictItems(Z),ee.value="1",ae.initWebSocket(),se=ae.onDictMessage(e=>{e.dictCode===Z&&(N.value=_(new Date,"YYYY-MM-DD HH:mm:ss").value,j(()=>{ie()}))})}),o(()=>{se?.()}),(e,a)=>{const t=z,l=W,s=M,o=Y,_=C,j=I,g=S,T=V,O=E,Z=D,ae=w,se=k,de=x,ce=h;return r(),i("div",A,[n(Z,{class:"box-card"},{header:d(()=>[u("div",F,[a[5]||(a[5]=u("span",null,"字典WebSocket实时更新演示",-1)),n(t,{type:p(te)?"success":"danger",size:"small",class:"ml-2"},{default:d(()=>[c(" WebSocket "+b(p(le)),1)]),_:1},8,["type"])])]),default:d(()=>[n(l,{type:"info",closable:!1,class:"mb-4"},{default:d(()=>[...a[6]||(a[6]=[c(' 本示例展示WebSocket实时更新字典缓存的效果。您可以编辑"男"性别字典项，保存后后端将通过WebSocket通知所有客户端刷新缓存。 ',-1)])]),_:1}),n(ce,{gutter:16},{default:d(()=>[n(ae,{span:8},{default:d(()=>[n(Z,{shadow:"hover",class:"dict-card"},{header:d(()=>[u("div",J,[a[8]||(a[8]=u("span",null,"性别字典项 - 男",-1)),n(s,{type:"warning",size:"small",onClick:re},{default:d(()=>[...a[7]||(a[7]=[c("重新加载",-1)])]),_:1})])]),default:d(()=>[u("div",null,[p($)?(r(),i("div",B,[n(T,{model:p($),"label-width":"80px"},{default:d(()=>[n(_,{label:"字典编码"},{default:d(()=>[n(o,{modelValue:p($).dictCode,"onUpdate:modelValue":a[0]||(a[0]=e=>p($).dictCode=e),disabled:""},null,8,["modelValue"])]),_:1}),n(_,{label:"字典标签"},{default:d(()=>[n(o,{modelValue:p($).label,"onUpdate:modelValue":a[1]||(a[1]=e=>p($).label=e)},null,8,["modelValue"])]),_:1}),n(_,{label:"字典值"},{default:d(()=>[n(o,{modelValue:p($).value,"onUpdate:modelValue":a[2]||(a[2]=e=>p($).value=e),disabled:""},null,8,["modelValue"])]),_:1}),n(_,{label:"标记颜色"},{default:d(()=>[n(g,{modelValue:p($).tagType,"onUpdate:modelValue":a[3]||(a[3]=e=>p($).tagType=e),placeholder:"选择标签类型",style:{width:"100%"}},{default:d(()=>[n(j,{value:"success",label:"success"},{default:d(()=>[n(t,{type:"success"},{default:d(()=>[...a[9]||(a[9]=[c("success",-1)])]),_:1})]),_:1}),n(j,{value:"warning",label:"warning"},{default:d(()=>[n(t,{type:"warning"},{default:d(()=>[...a[10]||(a[10]=[c("warning",-1)])]),_:1})]),_:1}),n(j,{value:"danger",label:"danger"},{default:d(()=>[n(t,{type:"danger"},{default:d(()=>[...a[11]||(a[11]=[c("danger",-1)])]),_:1})]),_:1}),n(j,{value:"info",label:"info"},{default:d(()=>[n(t,{type:"info"},{default:d(()=>[...a[12]||(a[12]=[c("info",-1)])]),_:1})]),_:1}),n(j,{value:"primary",label:"primary"},{default:d(()=>[n(t,{type:"primary"},{default:d(()=>[...a[13]||(a[13]=[c("primary",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),n(_,null,{default:d(()=>[n(s,{type:"primary",loading:p(H),onClick:ne},{default:d(()=>[...a[14]||(a[14]=[c("保存",-1)])]),_:1},8,["loading"]),n(s,{onClick:re},{default:d(()=>[...a[15]||(a[15]=[c("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])])):(r(),m(O,{key:1,description:"暂无字典数据"}))])]),_:1})]),_:1}),n(ae,{span:8},{default:d(()=>[n(Z,{shadow:"hover",class:"dict-card"},{header:d(()=>[u("div",R,[a[17]||(a[17]=u("span",null,"字典组件展示",-1)),n(s,{type:"primary",size:"small",onClick:ie},{default:d(()=>[...a[16]||(a[16]=[c(" 手动刷新 ",-1)])]),_:1})])]),default:d(()=>[u("div",X,[a[18]||(a[18]=u("h4",{class:"mt-4 mb-3"},"性别组件",-1)),n(de,{modelValue:p(ee),"onUpdate:modelValue":a[4]||(a[4]=e=>f(ee)?ee.value=e:null)},{default:d(()=>[(r(!0),i(v,null,y(p(U).getDictItems("gender"),e=>(r(),m(se,{key:e.value,value:e.value},{default:d(()=>[c(b(e.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),a[19]||(a[19]=u("h4",{class:"mt-4 mb-3"},"性别标签",-1)),u("div",null,[(r(!0),i(v,null,y(p(U).getDictItems("gender"),e=>(r(),m(t,{key:e.value,type:e.tagType||void 0,class:"mr-2"},{default:d(()=>[c(b(e.label),1)]),_:2},1032,["type"]))),128))]),u("div",q,[u("div",K,"已选择值: "+b(p(ee)),1),u("div",P,"最后更新: "+b(p(N)),1)])])]),_:1})]),_:1}),n(ae,{span:8},{default:d(()=>[n(Z,{shadow:"hover",class:"dict-card"},{header:d(()=>[u("div",Q,[a[22]||(a[22]=u("span",null,"字典缓存数据",-1)),u("div",null,[p(oe)?(r(),m(t,{key:0,type:"success",class:"ml-2",size:"small"},{default:d(()=>[...a[20]||(a[20]=[c(" 已缓存 ",-1)])]),_:1})):(r(),m(t,{key:1,type:"danger",class:"ml-2",size:"small"},{default:d(()=>[...a[21]||(a[21]=[c("未缓存",-1)])]),_:1}))])])]),default:d(()=>[u("div",G,[u("pre",L,b(JSON.stringify(p(U).getDictItems("gender"),null,2)),1)])]),_:1})]),_:1})]),_:1})]),_:1})])}}}),[["__scopeId","data-v-d5b454f1"]]);export{$ as default};
