import{d as e,aJ as a,al as t,r as l,S as o,c as r,ar as i,o as s,bR as d,g as n,f as p,C as m,m as u,w as c,a3 as f,i as v,a4 as b,$ as g,e as j,h as _,F as h,aA as y,P as V,Q as x,dK as w,bc as k,aG as C}from"./index.BRkeMZJ3.js";import{v as U}from"./loading.Dn8Ekme4.js";import{E}from"./drawer.BMAOjAPh.js";import"./overlay.B74PT_0R.js";import{E as I}from"./switch.CRXibt18.js";import{_ as R}from"./index.vue_vue_type_script_setup_true_lang.DJECs62s.js";/* empty css            */import{E as A,a as S}from"./select.DHMx-tmf.js";import"./scrollbar.DMKyA7dr.js";import"./popper.DER5TYS7.js";import"./tree.Dw_vNg12.js";import"./checkbox.Dpesx2gT.js";import"./text.CBSgRwvb.js";import{E as D}from"./tree-select.7HGTpj9Q.js";import{E as T}from"./card.CST3Uq_k.js";import{_ as B}from"./index.yFkdAzYu.js";import{a as O,E as q}from"./table-column.BjRyRvOQ.js";/* empty css                */import{E as z,a as F}from"./form-item.JlMsiVsg.js";/* empty css               */import{E as L}from"./date-picker-panel.QRhWJeoR.js";import{E as P}from"./input.Bux73yZ-.js";import{f as N}from"./formatters.nkZtAjN3.js";import{D as K}from"./dept-api.BHtsptk-.js";import{R as $}from"./role-api.xGclvxl0.js";import{_ as J}from"./UserImport.vue_vue_type_script_setup_true_lang.DcHWfSpg.js";/* empty css                    */import{E as Q}from"./index.BR6POwKd.js";import{E as Y}from"./index.KX8zJy3q.js";import{E as Z}from"./index.Bj3BHfG5.js";import"./index.Cuc277AH.js";import"./aria.Cpd_B0tV.js";import"./index.wVkM0nba.js";import"./vnode.CYWHXGFs.js";import"./event.BwRzfsZt.js";import"./error.D_Dr4eZ1.js";import"./scroll.C927-KDk.js";import"./use-form-common-props.CqA0Qg8c.js";import"./index.BRiHEm1a.js";/* empty css                       */import"./radio-group.CsTPHqbS.js";import"./token.DWNpOE8r.js";import"./strings.DGUDJ19u.js";import"./castArray.pFen9Tkv.js";import"./index.VuFFzU1E.js";import"./debounce.rjHeiI51.js";import"./toNumber.EWNBt7Mu.js";import"./_baseIteratee.CjqgL3zj.js";import"./index.CEucKegN.js";import"./index.DD4tnXLg.js";import"./index.Bm11Utof.js";import"./pagination.DlOl3sdC.js";import"./_plugin-vue_export-helper.BCo6x5W8.js";import"./_initCloneObject.J_PfCM3P.js";import"./raf.Bwc5kBDX.js";import"./_baseClone.BF5RejrX.js";import"./dayjs.min.Cw18mfHk.js";import"./index.CsUb5NiF.js";import"./index.CHnr7aKg.js";import"./alert.D4-fJTwI.js";import"./dialog.Cn7g8dff.js";import"./refs.Cw5r5QN8.js";import"./upload.lkgSWx3K.js";import"./progress.JC6-V-6e.js";import"./link.CdKuLgwl.js";const G={class:"app-container"},M={class:"search-container"},W={class:"data-table__toolbar"},X={class:"data-table__toolbar--actions"},H={class:"data-table__toolbar--tools"},ee={class:"dialog-footer"},ae=e({name:"User",inheritAttrs:!1,__name:"Index",setup(e){const ae=a(),te=t(),le=l(),oe=l(),re=o({page:1,per_page:10}),ie=l(),se=l(0),de=l(!1),ne=o({visible:!1,title:"新增用户"}),pe=r(()=>te.device===i.DESKTOP?"600px":"90%"),me=o({}),ue=o({email:[{required:!0,message:"Email不能为空",trigger:"blur"}],name:[{required:!0,message:"用户昵称不能为空",trigger:"blur"}],deptId:[{required:!0,message:"所属部门不能为空",trigger:"blur"}],roleIds:[{required:!0,message:"用户角色不能为空",trigger:"blur"}]}),ce=l([]),fe=l(),ve=l(),be=l(!1);async function ge(){de.value=!0;try{const e=await k.getPage(re);ie.value=e.data,se.value=e.meta.total}finally{de.value=!1}}function je(){re.page=1,ge()}function _e(){le.value.resetFields(),re.page=1,re.deptId=void 0,re.createTime=void 0,ge()}function he(e){ce.value=e.map(e=>e.id)}async function ye(e){ne.visible=!0;const a=await $.getOptions();ve.value=a.data;const t=await K.getOptions();fe.value=t.data,e?(ne.title="修改用户",k.getFormData(e).then(e=>{const a=e.data;Object.assign(me,{...a})})):ne.title="新增用户"}function Ve(){ne.visible=!1,oe.value.resetFields(),oe.value.clearValidate(),me.id=void 0,me.status=1}const xe=w(()=>{oe.value.validate(e=>{if(e){const e=me.id;de.value=!0,e?k.update(e,me).then(()=>{C.success("修改用户成功"),Ve(),_e()}).finally(()=>de.value=!1):k.create(me).then(()=>{C.success("新增用户成功"),Ve(),_e()}).finally(()=>de.value=!1)}})},1e3);function we(e){const a=[e||ce.value].join(",");if(!a)return void C.warning("请勾选删除项");const t=ae.userInfo;!function(e,a=[],t){return!!t?.userId&&(!(!e||e.toString()!==t.userId)||!e&&a.length>0&&a.map(String).includes(t.userId))}(e,ce.value,t)?Z.confirm("确认删除用户?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{de.value=!0,k.deleteByIds(a).then(()=>{C.success("删除成功"),_e()}).finally(()=>de.value=!1)},()=>{C.info("已取消删除")}):C.error("不能删除当前登录用户")}function ke(){be.value=!0}function Ce(){k.export(re).then(e=>{const a=e.data,t=decodeURI(e.headers["content-disposition"].split(";")[1].split("=")[1]),l=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=utf-8"}),o=window.URL.createObjectURL(l),r=document.createElement("a");r.href=o,r.download=t,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(o)})}return s(()=>{je()}),(e,a)=>{const t=P,l=z,o=S,r=A,i=L,s=Q,w=F,K=q,$=Y,ae=O,te=B,Ue=T,Ee=D,Ie=R,Re=I,Ae=E,Se=d("hasPerm"),De=U;return p(),n("div",G,[m("div",M,[u(w,{ref_key:"queryFormRef",ref:le,model:v(re),inline:!0,"label-width":"auto"},{default:c(()=>[u(l,{label:"Email",prop:"email"},{default:c(()=>[u(t,{modelValue:v(re).email,"onUpdate:modelValue":a[0]||(a[0]=e=>v(re).email=e),placeholder:"Email",clearable:"",onKeyup:f(je,["enter"])},null,8,["modelValue"])]),_:1}),u(l,{label:"Status",prop:"status"},{default:c(()=>[u(r,{modelValue:v(re).status,"onUpdate:modelValue":a[1]||(a[1]=e=>v(re).status=e),placeholder:"All",clearable:"",style:{width:"100px"}},{default:c(()=>[u(o,{label:"Active",value:"active"}),u(o,{label:"Inactive",value:"inactive"})]),_:1},8,["modelValue"])]),_:1}),u(l,{label:"Created At"},{default:c(()=>[u(i,{modelValue:v(re).created_at,"onUpdate:modelValue":a[2]||(a[2]=e=>v(re).created_at=e),type:"datetimerange","range-separator":"To","start-placeholder":"Start date","end-placeholder":"End date","default-time":[new Date(0,0,0,0,0,0),new Date(0,0,0,23,59,59)]},null,8,["modelValue","default-time"])]),_:1}),u(l,{class:"search-buttons"},{default:c(()=>[u(s,{type:"primary",icon:"search",onClick:je},{default:c(()=>[...a[19]||(a[19]=[b("Search",-1)])]),_:1}),u(s,{icon:"refresh",onClick:_e},{default:c(()=>[...a[20]||(a[20]=[b("Reset",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),u(Ue,{shadow:"hover",class:"data-table"},{default:c(()=>[m("div",W,[m("div",X,[g((p(),j(s,{type:"success",icon:"plus",onClick:a[3]||(a[3]=e=>ye())},{default:c(()=>[...a[21]||(a[21]=[b(" Add ",-1)])]),_:1})),[[Se,["sys:user:add"]]]),g((p(),j(s,{type:"danger",icon:"delete",disabled:0===v(ce).length,onClick:a[4]||(a[4]=e=>we())},{default:c(()=>[...a[22]||(a[22]=[b(" Delete ",-1)])]),_:1},8,["disabled"])),[[Se,"sys:user:delete"]])]),m("div",H,[g((p(),j(s,{icon:"upload",onClick:ke},{default:c(()=>[...a[23]||(a[23]=[b(" Import ",-1)])]),_:1})),[[Se,"sys:user:import"]]),g((p(),j(s,{icon:"download",onClick:Ce},{default:c(()=>[...a[24]||(a[24]=[b(" Export ",-1)])]),_:1})),[[Se,"sys:user:export"]])])]),g((p(),j(ae,{data:v(ie),border:"",stripe:"","highlight-current-row":"",class:"data-table__content",onSelectionChange:he},{default:c(()=>[u(K,{type:"selection",width:"50",align:"center"}),u(K,{label:"ID",prop:"id"}),u(K,{label:"Email",prop:"email"}),u(K,{label:"Name",align:"center",prop:"name"}),u(K,{label:"Roles",align:"center",prop:"deptName"}),u(K,{label:"Status",align:"center",prop:"status"},{default:c(e=>[u($,{type:"active"==e.row.status?"success":"info"},{default:c(()=>[b(h("active"==e.row.status?"Active":"Inactive"),1)]),_:2},1032,["type"])]),_:1}),u(K,{label:"Created At",align:"center",prop:"created_at",formatter:v(N)},null,8,["formatter"]),u(K,{label:"Actions",fixed:"right",width:"220"},{default:c(e=>[g((p(),j(s,{type:"primary",icon:"RefreshLeft",size:"small",link:"",onClick:a=>{return t=e.row,void Z.prompt("请输入用户【"+t.email+"】的新密码","重置密码",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(({value:e})=>{if(!e||e.length<6)return C.warning("密码至少需要6位字符，请重新输入"),!1;k.resetPassword(t.id,e).then(()=>{C.success("密码重置成功，新密码是："+e)})},()=>{C.info("已取消重置密码")});var t}},{default:c(()=>[...a[25]||(a[25]=[b(" 重置密码 ",-1)])]),_:1},8,["onClick"])),[[Se,"sys:user:reset-password"]]),g((p(),j(s,{type:"primary",icon:"edit",link:"",size:"small",onClick:a=>ye(e.row.id)},{default:c(()=>[...a[26]||(a[26]=[b(" 编辑 ",-1)])]),_:1},8,["onClick"])),[[Se,"sys:user:edit"]]),g((p(),j(s,{type:"danger",icon:"delete",link:"",size:"small",onClick:a=>we(e.row.id)},{default:c(()=>[...a[27]||(a[27]=[b(" 删除 ",-1)])]),_:1},8,["onClick"])),[[Se,"sys:user:delete"]])]),_:1})]),_:1},8,["data"])),[[De,v(de)]]),v(se)>0?(p(),j(te,{key:0,total:v(se),"onUpdate:total":a[5]||(a[5]=e=>y(se)?se.value=e:null),page:v(re).page,"onUpdate:page":a[6]||(a[6]=e=>v(re).page=e),limit:v(re).per_page,"onUpdate:limit":a[7]||(a[7]=e=>v(re).per_page=e),onPagination:ge},null,8,["total","page","limit"])):_("",!0)]),_:1}),u(Ae,{modelValue:v(ne).visible,"onUpdate:modelValue":a[16]||(a[16]=e=>v(ne).visible=e),title:v(ne).title,"append-to-body":"",size:v(pe),onClose:Ve},{footer:c(()=>[m("div",ee,[u(s,{type:"primary",onClick:v(xe)},{default:c(()=>[...a[28]||(a[28]=[b("确 定",-1)])]),_:1},8,["onClick"]),u(s,{onClick:Ve},{default:c(()=>[...a[29]||(a[29]=[b("取 消",-1)])]),_:1})])]),default:c(()=>[u(w,{ref_key:"userFormRef",ref:oe,model:v(me),rules:v(ue),"label-width":"80px"},{default:c(()=>[u(l,{label:"Email",prop:"email"},{default:c(()=>[u(t,{modelValue:v(me).email,"onUpdate:modelValue":a[8]||(a[8]=e=>v(me).email=e),readonly:!!v(me).id,placeholder:"请输入Email"},null,8,["modelValue","readonly"])]),_:1}),u(l,{label:"用户昵称",prop:"name"},{default:c(()=>[u(t,{modelValue:v(me).name,"onUpdate:modelValue":a[9]||(a[9]=e=>v(me).name=e),placeholder:"请输入用户昵称"},null,8,["modelValue"])]),_:1}),u(l,{label:"所属部门",prop:"deptId"},{default:c(()=>[u(Ee,{modelValue:v(me).deptId,"onUpdate:modelValue":a[10]||(a[10]=e=>v(me).deptId=e),placeholder:"请选择所属部门",data:v(fe),filterable:"","check-strictly":"","render-after-expand":!1},null,8,["modelValue","data"])]),_:1}),u(l,{label:"性别",prop:"gender"},{default:c(()=>[u(Ie,{modelValue:v(me).gender,"onUpdate:modelValue":a[11]||(a[11]=e=>v(me).gender=e),code:"gender"},null,8,["modelValue"])]),_:1}),u(l,{label:"角色",prop:"roleIds"},{default:c(()=>[u(r,{modelValue:v(me).roleIds,"onUpdate:modelValue":a[12]||(a[12]=e=>v(me).roleIds=e),multiple:"",placeholder:"请选择"},{default:c(()=>[(p(!0),n(V,null,x(v(ve),e=>(p(),j(o,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),u(l,{label:"手机号码",prop:"mobile"},{default:c(()=>[u(t,{modelValue:v(me).mobile,"onUpdate:modelValue":a[13]||(a[13]=e=>v(me).mobile=e),placeholder:"请输入手机号码",maxlength:"11"},null,8,["modelValue"])]),_:1}),u(l,{label:"邮箱",prop:"email"},{default:c(()=>[u(t,{modelValue:v(me).email,"onUpdate:modelValue":a[14]||(a[14]=e=>v(me).email=e),placeholder:"请输入邮箱",maxlength:"50"},null,8,["modelValue"])]),_:1}),u(l,{label:"状态",prop:"status"},{default:c(()=>[u(Re,{modelValue:v(me).status,"onUpdate:modelValue":a[15]||(a[15]=e=>v(me).status=e),"inline-prompt":"","active-text":"正常","inactive-text":"禁用","active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title","size"]),u(J,{modelValue:v(be),"onUpdate:modelValue":a[17]||(a[17]=e=>y(be)?be.value=e:null),onImportSuccess:a[18]||(a[18]=e=>je())},null,8,["modelValue"])])}}});export{ae as default};
