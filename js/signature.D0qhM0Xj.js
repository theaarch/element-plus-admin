import{d as t,r as e,o,g as n,f as a,C as s,h as r,m as l,w as i,a4 as c,j as u,i as d,aG as p}from"./index.DxBlw8vg.js";/* empty css               */import{F as f}from"./file-api.BYu5q9eN.js";import{E as h}from"./index.KYpUS13f.js";import{_ as m}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./index.BP_sdoaf.js";import"./use-form-common-props.D4_6zUCF.js";const v={class:"canvas-dom"},g=["src"],w=m(t({__name:"signature",setup(t){const m=e(""),w=e();let y,_=!1;const j=t=>{let e;if(t.offsetX){const{offsetX:o,offsetY:n}=t;e=[o,n]}else{const{top:o,left:n}=w.value.getBoundingClientRect();e=[t.touches[0].clientX-n,t.touches[0].clientY-o]}return e};let k=0,C=0;const x=t=>{[k,C]=j(t),_=!0},R=t=>{if(_){const[e,o]=j(t);!function(t,e,o,n,a){a.beginPath(),a.globalAlpha=1,a.lineWidth=2,a.strokeStyle="#000",a.moveTo(t,e),a.lineTo(o,n),a.closePath(),a.stroke()}(k,C,e,o,y),k=e,C=o}},b=()=>{_&&(_=!1)};o(()=>{y=w.value.getContext("2d")});const E=async()=>{if(T(w.value))return void p({type:"warning",message:"当前签名文件为空"});const t=D(w.value.toDataURL(),"签名.png");if(!t)return;const e=await f.uploadFile(t);M(),m.value=e.data.url},M=()=>{y.clearRect(0,0,w.value.width,w.value.height)},T=t=>{const e=document.createElement("canvas");return e.width=t.width,e.height=t.height,t.toDataURL()==e.toDataURL()},U=()=>{if(T(w.value))return void p({type:"warning",message:"当前签名文件为空"});const t=document.createElement("a");t.href=w.value.toDataURL(),t.download="签名";const e=new MouseEvent("click");t.dispatchEvent(e)},D=(t,e)=>{const o=t.split(",");if(!o.length)return;const n=o[0].match(/:(.*?);/);if(n){const t=atob(o[1]);let a=t.length;const s=new Uint8Array(a);for(;a--;)s[a]=t.charCodeAt(a);return new File([s],e,{type:n[1]})}};return(t,e)=>{const o=h;return a(),n("div",v,[e[3]||(e[3]=s("h3",null,"基于canvas实现的签名组件",-1)),s("header",null,[l(o,{type:"primary",onClick:U},{default:i(()=>[...e[0]||(e[0]=[c("保存为图片",-1)])]),_:1}),l(o,{onClick:E},{default:i(()=>[...e[1]||(e[1]=[c("保存到后端",-1)])]),_:1}),l(o,{onClick:M},{default:i(()=>[...e[2]||(e[2]=[c("清空签名",-1)])]),_:1})]),s("canvas",{ref_key:"canvas",ref:w,height:"200",width:"500",onMousedown:x,onMousemove:u(R,["stop","prevent"]),onMouseup:b,onTouchstart:x,onTouchmove:u(R,["stop","prevent"]),onTouchend:b},null,544),d(m)?(a(),n("img",{key:0,src:d(m),alt:"签名"},null,8,g)):r("",!0)])}}}),[["__scopeId","data-v-501f04db"]]);export{w as default};
