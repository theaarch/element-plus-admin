import{t as e,z as a,v as l,b2 as s,ba as r,_ as t,d as i,b as o,r as d,c as n,M as u,J as m,I as c,g as p,f,e as v,l as b,k as y,i as _,w as g,D as w,E as k,n as j,q as h,bb as V,S as C,o as P,m as x,bc as E,C as z,bd as F,F as I,as as S,a4 as U,h as q,aG as A}from"./index.CM47KQtG.js";import{E as Z}from"./dialog.BtEbwb-q.js";import"./overlay.BreQExSd.js";import{E as $,a as M}from"./form-item.BvU-fErQ.js";import{_ as N}from"./index.vue_vue_type_script_setup_true_lang.BlKT5Hni.js";import{E as R}from"./input.DICT-xuJ.js";import{E as B,a as O}from"./col.D2tAyVaX.js";import{E as D,a as J}from"./descriptions-item.5kO9wkYQ.js";import{E as T}from"./card.JRjeJkVW.js";import{E as G}from"./divider.BIDq4EJl.js";/* empty css               */import{F as Q}from"./file-api.CbmdhUtu.js";import{E as W}from"./index.p5pvUZ8p.js";import{_ as X}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./index.BkpZJorq.js";import"./aria.Cpd_B0tV.js";import"./refs.Cw5r5QN8.js";import"./index.C-zw5LL5.js";import"./vnode.3FsO1Zr2.js";import"./event.BwRzfsZt.js";import"./error.D_Dr4eZ1.js";import"./scroll.HB0cktN2.js";import"./use-form-common-props.CwNouOR0.js";import"./castArray.DwIa-ddT.js";import"./_baseClone.C_H9MAg3.js";import"./_initCloneObject.D6_TlKeT.js";import"./checkbox.DwMVycN-.js";import"./index.BpEbxuRh.js";/* empty css                       */import"./radio-group.BG5oxu62.js";/* empty css            */import"./select.CbuXqiqO.js";import"./popper.Dy7mreVG.js";import"./index.33C-WVq8.js";import"./scrollbar.DJ9OeN8B.js";import"./index.DB7b8zJj.js";import"./token.DWNpOE8r.js";import"./strings.CuGzRR0G.js";import"./index.BM1Y5O9s.js";import"./debounce.BSbgIsNH.js";import"./toNumber.CTKVBeqF.js";import"./_baseIteratee.Bz4YUaFH.js";import"./index.ChhW_Tvf.js";import"./index.DUp9k36Z.js";const Y=e({size:{type:[Number,String],values:r,default:"",validator:e=>s(e)},shape:{type:String,values:["circle","square"],default:"circle"},icon:{type:l},src:{type:String,default:""},alt:String,srcSet:String,fit:{type:a(String),default:"cover"}}),H={error:e=>e instanceof Event},K=i({name:"ElAvatar"});const L=h(t(i({...K,props:Y,emits:H,setup(e,{emit:a}){const l=e,r=o("avatar"),t=d(!1),i=n(()=>{const{size:e,icon:a,shape:s}=l,t=[r.b()];return u(e)&&t.push(r.m(e)),a&&t.push(r.m("icon")),s&&t.push(r.m(s)),t}),h=n(()=>{const{size:e}=l;return s(e)?r.cssVarBlock({size:m(e)||""}):void 0}),V=n(()=>({objectFit:l.fit}));function C(e){t.value=!0,a("error",e)}return c(()=>l.src,()=>t.value=!1),(e,a)=>(f(),p("span",{class:j(_(i)),style:y(_(h))},[!e.src&&!e.srcSet||t.value?e.icon?(f(),v(_(k),{key:1},{default:g(()=>[(f(),v(w(e.icon)))]),_:1})):b(e.$slots,"default",{key:2}):(f(),p("img",{key:0,src:e.src,alt:e.alt,srcset:e.srcSet,style:y(_(V)),onError:C},null,44,["src","alt","srcset"]))],6))}}),[["__file","avatar.vue"]])),ee={class:"profile-container"},ae={class:"user-info"},le={class:"avatar-wrapper"},se={class:"user-name"},re={class:"nickname"},te={class:"user-role"},ie={class:"security-item"},oe={class:"dialog-footer"},de=X(i({__name:"Profile",setup(e){const a=V(),l=d({}),s=C({visible:!1,title:"",type:""}),r=d(),t=d(),i=d(),o=d(),n=C({}),u=C({}),m=C({}),c=C({}),b=d(0),y=d(),w=d(0),j=d(),h={oldPassword:[{required:!0,message:"请输入原密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"}]},X={mobile:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3|4|5|6|7|8|9][0-9]\d{8}$/,message:"请输入正确的手机号码",trigger:"blur"}],code:[{required:!0,message:"请输入验证码",trigger:"blur"}]},Y={email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{pattern:/\w[-\w.+]*@([A-Za-z0-9][-A-Za-z0-9]+\.)+[A-Za-z]{2,14}/,message:"请输入正确的邮箱地址",trigger:"blur"}],code:[{required:!0,message:"请输入验证码",trigger:"blur"}]},H=e=>{switch(s.type=e,s.visible=!0,e){case"account":s.title="账号资料",n.id=l.value.id,n.nickname=l.value.nickname,n.gender=l.value.gender;break;case"password":s.title="修改密码";break;case"mobile":s.title="绑定手机";break;case"email":s.title="绑定邮箱"}};function K(){if(!m.mobile)return void A.error("请输入手机号");/^1[3-9]\d{9}$/.test(m.mobile)?E.sendMobileCode(m.mobile).then(()=>{A.success("验证码发送成功"),b.value=60,y.value=setInterval(()=>{b.value>0?b.value-=1:clearInterval(y.value)},1e3)}):A.error("手机号格式不正确")}function de(){if(!c.email)return void A.error("请输入邮箱");/\w[-\w.+]*@([A-Za-z0-9][-A-Za-z0-9]+\.)+[A-Za-z]{2,14}/.test(c.email)?E.sendEmailCode(c.email).then(()=>{A.success("验证码发送成功"),w.value=60,j.value=setInterval(()=>{w.value>0?w.value-=1:clearInterval(j.value)},1e3)}):A.error("邮箱格式不正确")}const ne=async()=>{if("account"===s.type)E.updateProfile(n).then(()=>{A.success("账号资料修改成功"),s.visible=!1,fe()});else if("password"===s.type){if(u.newPassword!==u.confirmPassword)return void A.error("两次输入的密码不一致");E.changePassword(u).then(()=>{A.success("密码修改成功"),s.visible=!1})}else"mobile"===s.type?E.bindOrChangeMobile(m).then(()=>{A.success("手机号绑定成功"),s.visible=!1,fe()}):"email"===s.type&&E.bindOrChangeEmail(c).then(()=>{A.success("邮箱绑定成功"),s.visible=!1,fe()})},ue=()=>{s.visible=!1,"account"===s.type?r.value?.resetFields():"password"===s.type?t.value?.resetFields():"mobile"===s.type?i.value?.resetFields():"email"===s.type&&o.value?.resetFields()},me=d(null),ce=()=>{me.value?.click()},pe=async e=>{const l=e.target,s=l.files?l.files[0]:null;if(s)try{const e=(await Q.uploadFile(s)).data;await E.updateProfile({avatar:e.url}),a.userInfo.avatar=e.url}catch(r){A.error("头像上传失败")}},fe=async()=>{const e=(await E.getProfile()).data;l.value=e};return P(async()=>{y.value&&clearInterval(y.value),j.value&&clearInterval(j.value),await fe()}),(e,d)=>{const y=L,j=W,V=S("Edit"),C=k,P=G,E=T,A=O,Q=S("Male"),fe=S("Female"),ve=J,be=D,ye=B,_e=R,ge=$,we=N,ke=M,je=Z;return f(),p("div",ee,[x(ye,{gutter:20},{default:g(()=>[x(A,{span:8},{default:g(()=>[x(E,{class:"user-card"},{default:g(()=>[z("div",ae,[z("div",le,[x(y,{src:_(a).userInfo.avatar,size:100},null,8,["src"]),x(j,{type:"info",class:"avatar-edit-btn",circle:"",icon:_(F),size:"small",onClick:ce},null,8,["icon"]),z("input",{ref_key:"fileInput",ref:me,type:"file",style:{display:"none"},accept:"image/*",onChange:pe},null,544)]),z("div",se,[z("span",re,I(_(l).nickname),1),x(C,{class:"edit-icon",onClick:d[0]||(d[0]=e=>H("account"))},{default:g(()=>[x(V)]),_:1})]),z("div",te,I(_(l).roleNames),1)]),x(P),d[16]||(d[16]=z("div",{class:"user-stats"},[z("div",{class:"stat-item"},[z("div",{class:"stat-value"},"0"),z("div",{class:"stat-label"},"待办")]),z("div",{class:"stat-item"},[z("div",{class:"stat-value"},"0"),z("div",{class:"stat-label"},"消息")]),z("div",{class:"stat-item"},[z("div",{class:"stat-value"},"0"),z("div",{class:"stat-label"},"通知")])],-1))]),_:1})]),_:1}),x(A,{span:16},{default:g(()=>[x(E,{class:"info-card"},{header:g(()=>[...d[17]||(d[17]=[z("div",{class:"card-header"},[z("span",null,"账号信息")],-1)])]),default:g(()=>[x(be,{column:1,border:""},{default:g(()=>[x(ve,{label:"用户名"},{default:g(()=>[U(I(_(l).username)+" ",1),1===_(l).gender?(f(),v(C,{key:0,class:"gender-icon male"},{default:g(()=>[x(Q)]),_:1})):(f(),v(C,{key:1,class:"gender-icon female"},{default:g(()=>[x(fe)]),_:1}))]),_:1}),x(ve,{label:"手机号码"},{default:g(()=>[U(I(_(l).mobile||"未绑定")+" ",1),_(l).mobile?(f(),v(j,{key:0,type:"primary",link:"",onClick:d[1]||(d[1]=()=>H("mobile"))},{default:g(()=>[...d[18]||(d[18]=[U(" 更换 ",-1)])]),_:1})):(f(),v(j,{key:1,type:"primary",link:"",onClick:d[2]||(d[2]=()=>H("mobile"))},{default:g(()=>[...d[19]||(d[19]=[U(" 绑定 ",-1)])]),_:1}))]),_:1}),x(ve,{label:"邮箱"},{default:g(()=>[U(I(_(l).email||"未绑定")+" ",1),_(l).email?(f(),v(j,{key:0,type:"primary",link:"",onClick:d[3]||(d[3]=()=>H("email"))},{default:g(()=>[...d[20]||(d[20]=[U(" 更换 ",-1)])]),_:1})):(f(),v(j,{key:1,type:"primary",link:"",onClick:d[4]||(d[4]=()=>H("email"))},{default:g(()=>[...d[21]||(d[21]=[U(" 绑定 ",-1)])]),_:1}))]),_:1}),x(ve,{label:"部门"},{default:g(()=>[U(I(_(l).deptName),1)]),_:1}),x(ve,{label:"创建时间"},{default:g(()=>[U(I(_(l).createTime),1)]),_:1})]),_:1})]),_:1}),x(E,{class:"security-card"},{header:g(()=>[...d[22]||(d[22]=[z("div",{class:"card-header"},[z("span",null,"安全设置")],-1)])]),default:g(()=>[z("div",ie,[d[24]||(d[24]=z("div",{class:"security-info"},[z("div",{class:"security-title"},"账户密码"),z("div",{class:"security-desc"},"定期修改密码有助于保护账户安全")],-1)),x(j,{type:"primary",link:"",onClick:d[5]||(d[5]=()=>H("password"))},{default:g(()=>[...d[23]||(d[23]=[U(" 修改 ",-1)])]),_:1})])]),_:1})]),_:1})]),_:1}),x(je,{modelValue:_(s).visible,"onUpdate:modelValue":d[15]||(d[15]=e=>_(s).visible=e),title:_(s).title,width:500},{footer:g(()=>[z("span",oe,[x(j,{onClick:ue},{default:g(()=>[...d[25]||(d[25]=[U("取消",-1)])]),_:1}),x(j,{type:"primary",onClick:ne},{default:g(()=>[...d[26]||(d[26]=[U("确定",-1)])]),_:1})])]),default:g(()=>["account"===_(s).type?(f(),v(ke,{key:0,ref_key:"userProfileFormRef",ref:r,model:_(n),"label-width":100},{default:g(()=>[x(ge,{label:"昵称"},{default:g(()=>[x(_e,{modelValue:_(n).nickname,"onUpdate:modelValue":d[6]||(d[6]=e=>_(n).nickname=e)},null,8,["modelValue"])]),_:1}),x(ge,{label:"性别"},{default:g(()=>[x(we,{modelValue:_(n).gender,"onUpdate:modelValue":d[7]||(d[7]=e=>_(n).gender=e),code:"gender"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])):q("",!0),"password"===_(s).type?(f(),v(ke,{key:1,ref_key:"passwordChangeFormRef",ref:t,model:_(u),rules:h,"label-width":100},{default:g(()=>[x(ge,{label:"原密码",prop:"oldPassword"},{default:g(()=>[x(_e,{modelValue:_(u).oldPassword,"onUpdate:modelValue":d[8]||(d[8]=e=>_(u).oldPassword=e),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),x(ge,{label:"新密码",prop:"newPassword"},{default:g(()=>[x(_e,{modelValue:_(u).newPassword,"onUpdate:modelValue":d[9]||(d[9]=e=>_(u).newPassword=e),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),x(ge,{label:"确认密码",prop:"confirmPassword"},{default:g(()=>[x(_e,{modelValue:_(u).confirmPassword,"onUpdate:modelValue":d[10]||(d[10]=e=>_(u).confirmPassword=e),type:"password","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])):"mobile"===_(s).type?(f(),v(ke,{key:2,ref_key:"mobileBindingFormRef",ref:i,model:_(m),rules:X,"label-width":100},{default:g(()=>[x(ge,{label:"手机号码",prop:"mobile"},{default:g(()=>[x(_e,{modelValue:_(m).mobile,"onUpdate:modelValue":d[11]||(d[11]=e=>_(m).mobile=e),style:{width:"250px"}},null,8,["modelValue"])]),_:1}),x(ge,{label:"验证码",prop:"code"},{default:g(()=>[x(_e,{modelValue:_(m).code,"onUpdate:modelValue":d[12]||(d[12]=e=>_(m).code=e),style:{width:"250px"}},{append:g(()=>[x(j,{disabled:_(b)>0,onClick:K},{default:g(()=>[U(I(_(b)>0?`${_(b)}s后重新发送`:"发送验证码"),1)]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])):"email"===_(s).type?(f(),v(ke,{key:3,ref_key:"emailBindingFormRef",ref:o,model:_(c),rules:Y,"label-width":100},{default:g(()=>[x(ge,{label:"邮箱",prop:"email"},{default:g(()=>[x(_e,{modelValue:_(c).email,"onUpdate:modelValue":d[13]||(d[13]=e=>_(c).email=e),style:{width:"250px"}},null,8,["modelValue"])]),_:1}),x(ge,{label:"验证码",prop:"code"},{default:g(()=>[x(_e,{modelValue:_(c).code,"onUpdate:modelValue":d[14]||(d[14]=e=>_(c).code=e),style:{width:"250px"}},{append:g(()=>[x(j,{disabled:_(w)>0,onClick:de},{default:g(()=>[U(I(_(w)>0?`${_(w)}s后重新发送`:"发送验证码"),1)]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])):q("",!0)]),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-86eb2d4e"]]);export{de as default};
