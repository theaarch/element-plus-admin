import{d as e,r as t,o,g as n,f as s,C as a,h as r,m as i,w as l,a4 as c,j as u,i as p}from"./index.DRPoGZBk.js";/* empty css               */import{F as m}from"./file-api.DGfbDBKw.js";/* empty css                */import{E as d}from"./index.CATG-Bau.js";import{E as f}from"./index.CHumVb_u.js";import{_ as h}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./index.C88r2BaC.js";import"./use-form-common-props.DsMPcFL7.js";import"./typescript.CRqm1_SZ.js";const v={class:"canvas-dom"},g=["src"],w=h(e({__name:"signature",setup(e){const h=t(""),w=t();let _,j=!1;const y=e=>{let t;if(e.offsetX){const{offsetX:o,offsetY:n}=e;t=[o,n]}else{const{top:o,left:n}=w.value.getBoundingClientRect();t=[e.touches[0].clientX-n,e.touches[0].clientY-o]}return t};let k=0,x=0;const C=e=>{[k,x]=y(e),j=!0},E=e=>{if(j){const[t,o]=y(e);!function(e,t,o,n,s){s.beginPath(),s.globalAlpha=1,s.lineWidth=2,s.strokeStyle="#000",s.moveTo(e,t),s.lineTo(o,n),s.closePath(),s.stroke()}(k,x,t,o,_),k=t,x=o}},R=()=>{j&&(j=!1)};o(()=>{_=w.value.getContext("2d")});const D=async()=>{if(U(w.value))return void f({type:"warning",message:"当前签名文件为空"});const e=L(w.value.toDataURL(),"签名.png");if(!e)return;const t=await m.uploadFile(e);T(),h.value=t.url},T=()=>{_.clearRect(0,0,w.value.width,w.value.height)},U=e=>{const t=document.createElement("canvas");return t.width=e.width,t.height=e.height,e.toDataURL()==t.toDataURL()},b=()=>{if(U(w.value))return void f({type:"warning",message:"当前签名文件为空"});const e=document.createElement("a");e.href=w.value.toDataURL(),e.download="签名";const t=new MouseEvent("click");e.dispatchEvent(t)},L=(e,t)=>{const o=e.split(",");if(!o.length)return;const n=o[0].match(/:(.*?);/);if(n){const e=atob(o[1]);let s=e.length;const a=new Uint8Array(s);for(;s--;)a[s]=e.charCodeAt(s);return new File([a],t,{type:n[1]})}};return(e,t)=>{const o=d;return s(),n("div",v,[t[3]||(t[3]=a("h3",null,"基于canvas实现的签名组件",-1)),a("header",null,[i(o,{type:"primary",onClick:b},{default:l(()=>[...t[0]||(t[0]=[c("保存为图片",-1)])]),_:1}),i(o,{onClick:D},{default:l(()=>[...t[1]||(t[1]=[c("保存到后端",-1)])]),_:1}),i(o,{onClick:T},{default:l(()=>[...t[2]||(t[2]=[c("清空签名",-1)])]),_:1})]),a("canvas",{ref_key:"canvas",ref:w,height:"200",width:"500",onMousedown:C,onMousemove:u(E,["stop","prevent"]),onMouseup:R,onTouchstart:C,onTouchmove:u(E,["stop","prevent"]),onTouchend:R},null,544),p(h)?(s(),n("img",{key:0,src:p(h),alt:"签名"},null,8,g)):r("",!0)])}}}),[["__scopeId","data-v-e049ea72"]]);export{w as default};
