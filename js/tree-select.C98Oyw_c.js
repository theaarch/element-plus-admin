import{E as e,a as t}from"./select.Dg8cxWuu.js";import{E as l}from"./tree.C7HEleVO.js";import{b as a,I as s,c as o,aM as d,U as n,d as r,B as c,ad as i,bv as u,N as p,bw as h,bx as v,A as f,H as k,_ as m,r as y,S as C,o as b,ab as N,q as g}from"./index.DRPoGZBk.js";import{U as x}from"./event.BwRzfsZt.js";import{p as K}from"./index.F5OfedVa.js";import{e as O}from"./strings.aj8LsXir.js";import{s as E}from"./token.DWNpOE8r.js";const V=r({extends:t,setup(e,l){const a=t.setup(e,l);delete a.selectOptionClick;const o=c().proxy;return n(()=>{a.select.states.cachedOptions.get(o.value)||a.select.onOptionCreate(o)}),s(()=>l.attrs.visible,e=>{n(()=>{a.states.visible=e})},{immediate:!0}),a},methods:{selectOptionClick(){this.$el.parentElement.click()}}});function j(e){return e||0===e}function M(e){return i(e)&&e.length}function S(e){return i(e)?e:j(e)?[e]:[]}function A(e,t,l,a,s){for(let o=0;o<e.length;o++){const d=e[o];if(t(d,o,e,s))return a?a(d,o,e,s):d;{const e=l(d);if(M(e)){const s=A(e,t,l,a,d);if(s)return s}}}}function w(e,t,l,a){for(let s=0;s<e.length;s++){const o=e[s];t(o,s,e,a);const d=l(o);M(d)&&w(d,t,l,o)}}var H=r({props:{data:{type:Array,default:()=>[]}},setup(e){const t=f(E);return s(()=>e.data,()=>{var l;e.data.forEach(e=>{t.states.cachedOptions.has(e.value)||t.states.cachedOptions.set(e.value,e)});const a=(null==(l=t.selectRef)?void 0:l.querySelectorAll("input"))||[];k&&!Array.from(a).includes(document.activeElement)&&t.setSelected()},{flush:"post",immediate:!0}),()=>{}}});const L=g(m(r({name:"ElTreeSelect",inheritAttrs:!1,props:{...e.props,...l.props,cacheData:{type:Array,default:()=>[]}},setup(t,r){const{slots:c,expose:i}=r,f=y(),k=y(),m=o(()=>t.nodeKey||t.valueKey||"value"),g=((t,{attrs:l,emit:r},{select:c,tree:i,key:u})=>{const p=a("tree-select");return s(()=>t.data,()=>{t.filterable&&n(()=>{var e,t;null==(t=i.value)||t.filter(null==(e=c.value)?void 0:e.states.inputValue)})},{flush:"post"}),{...K(d(t),Object.keys(e.props)),...l,class:o(()=>l.class),style:o(()=>l.style),"onUpdate:modelValue":e=>r(x,e),valueKey:u,popperClass:o(()=>{const e=[p.e("popper")];return t.popperClass&&e.push(t.popperClass),e.join(" ")}),filterMethod:(e="")=>{var l;t.filterMethod?t.filterMethod(e):t.remoteMethod?t.remoteMethod(e):null==(l=i.value)||l.filter(e)}}})(t,r,{select:f,tree:k,key:m}),{cacheOptions:E,...L}=((e,{attrs:t,slots:a,emit:r},{select:c,tree:i,key:f})=>{s([()=>e.modelValue,i],()=>{e.showCheckbox&&n(()=>{const t=i.value;t&&!v(t.getCheckedKeys(),S(e.modelValue))&&t.setCheckedKeys(S(e.modelValue))})},{immediate:!0,deep:!0});const k=o(()=>({value:f.value,label:"label",children:"children",disabled:"disabled",isLeaf:"isLeaf",...e.props})),m=(e,t)=>{var l;const a=k.value[e];return h(a)?a(t,null==(l=i.value)?void 0:l.getNode(m("value",t))):t[a]},y=S(e.modelValue).map(t=>A(e.data||[],e=>m("value",e)===t,e=>m("children",e),(e,t,l,a)=>a&&m("value",a))).filter(e=>j(e)),C=o(()=>{if(!e.renderAfterExpand&&!e.lazy)return[];const t=[];return w(e.data.concat(e.cacheData),e=>{const l=m("value",e);t.push({value:l,currentLabel:m("label",e),isDisabled:m("disabled",e)})},e=>m("children",e)),t}),b=()=>{var e;return null==(e=i.value)?void 0:e.getCheckedKeys().filter(e=>{var t;const l=null==(t=i.value)?void 0:t.getNode(e);return!p(l)&&u(l.childNodes)})};return{...K(d(e),Object.keys(l.props)),...t,nodeKey:f,expandOnClickNode:o(()=>!e.checkStrictly&&e.expandOnClickNode),defaultExpandedKeys:o(()=>e.defaultExpandedKeys?e.defaultExpandedKeys.concat(y):y),renderContent:(t,{node:l,data:s,store:o})=>t(V,{value:m("value",s),label:m("label",s),disabled:m("disabled",s),visible:l.visible},e.renderContent?()=>e.renderContent(t,{node:l,data:s,store:o}):a.default?()=>a.default({node:l,data:s,store:o}):void 0),filterNodeMethod:(t,l,a)=>e.filterNodeMethod?e.filterNodeMethod(t,l,a):!t||new RegExp(O(t),"i").test(m("label",l)||""),onNodeClick:(l,a,s)=>{var o,d,n,r;if(null==(o=t.onNodeClick)||o.call(t,l,a,s),!e.showCheckbox||!e.checkOnClickNode){if(e.showCheckbox||!e.checkStrictly&&!a.isLeaf)e.expandOnClickNode&&s.proxy.handleExpandIconClick();else if(!m("disabled",l)){const e=null==(d=c.value)?void 0:d.states.options.get(m("value",l));null==(n=c.value)||n.handleOptionSelect(e)}null==(r=c.value)||r.focus()}},onCheck:(l,a)=>{var s;if(!e.showCheckbox)return;const o=m("value",l),d={};w([i.value.store.root],e=>d[e.key]=e,e=>e.childNodes);const u=a.checkedKeys,p=e.multiple?S(e.modelValue).filter(e=>!(e in d)&&!u.includes(e)):[],h=p.concat(u);if(e.checkStrictly)r(x,e.multiple?h:h.includes(o)?o:void 0);else if(e.multiple){const e=b();r(x,p.concat(e))}else{const t=A([l],e=>!M(m("children",e))&&!m("disabled",e),e=>m("children",e)),a=t?m("value",t):void 0,s=j(e.modelValue)&&!!A([l],t=>m("value",t)===e.modelValue,e=>m("children",e));r(x,a===e.modelValue||s?void 0:a)}n(()=>{var a;const s=S(e.modelValue);i.value.setCheckedKeys(s),null==(a=t.onCheck)||a.call(t,l,{checkedKeys:i.value.getCheckedKeys(),checkedNodes:i.value.getCheckedNodes(),halfCheckedKeys:i.value.getHalfCheckedKeys(),halfCheckedNodes:i.value.getHalfCheckedNodes()})}),null==(s=c.value)||s.focus()},onNodeExpand:(l,a,s)=>{var o;null==(o=t.onNodeExpand)||o.call(t,l,a,s),n(()=>{if(!e.checkStrictly&&e.lazy&&e.multiple&&a.checked){const t={},l=i.value.getCheckedKeys();w([i.value.store.root],e=>t[e.key]=e,e=>e.childNodes);const a=S(e.modelValue).filter(e=>!(e in t)&&!l.includes(e)),s=b();r(x,a.concat(s))}})},cacheOptions:C}})(t,r,{select:f,tree:k,key:m}),R=C({});return i(R),b(()=>{Object.assign(R,{...K(k.value,["filter","updateKeyChildren","getCheckedNodes","setCheckedNodes","getCheckedKeys","setCheckedKeys","setChecked","getHalfCheckedNodes","getHalfCheckedKeys","getCurrentKey","getCurrentNode","setCurrentKey","setCurrentNode","getNode","remove","append","insertBefore","insertAfter"]),...K(f.value,["focus","blur","selectedLabel"]),treeRef:k.value,selectRef:f.value})}),()=>N(e,C({...g,ref:e=>f.value=e}),{...c,default:()=>[N(H,{data:E.value}),N(l,C({...L,ref:e=>k.value=e}))]})}}),[["__file","tree-select.vue"]]));export{L as E};
