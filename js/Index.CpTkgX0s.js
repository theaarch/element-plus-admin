import{d as e,al as a,r as l,S as t,c as o,ar as i,I as s,o as r,as as n,g as d,f as u,C as m,m as c,w as p,a3 as f,i as v,a4 as g,$ as _,e as b,h as j,aA as h,F as y,E as k,aG as x,bn as C}from"./index.CM47KQtG.js";import{v as V}from"./loading.CxFowczj.js";import{E}from"./drawer.JI_saeGj.js";import"./overlay.BreQExSd.js";import{E as w}from"./tree.42EjxIGk.js";import{E as R}from"./checkbox.DwMVycN-.js";import"./text.DEj3NSAD.js";/* empty css                */import{E as U}from"./popper.Dy7mreVG.js";import{E as N}from"./dialog.BtEbwb-q.js";import{E as A}from"./card.JRjeJkVW.js";import{_ as D}from"./index.DfSWtJFb.js";import{a as S,E as z}from"./table-column.agJiczKe.js";import"./scrollbar.DJ9OeN8B.js";/* empty css            */import{E as F,a as I}from"./form-item.BvU-fErQ.js";/* empty css               */import{E as O}from"./input.DICT-xuJ.js";import{R as P}from"./role-api.DdK9ZxAB.js";/* empty css                    */import{E as G}from"./index.p5pvUZ8p.js";import{E as T}from"./index.DOFvcLEl.js";import"./index.BkpZJorq.js";import"./aria.Cpd_B0tV.js";import"./index.C-zw5LL5.js";import"./vnode.3FsO1Zr2.js";import"./event.BwRzfsZt.js";import"./error.D_Dr4eZ1.js";import"./scroll.HB0cktN2.js";import"./use-form-common-props.CwNouOR0.js";import"./token.DWNpOE8r.js";import"./index.ChigPKlb.js";import"./index.BpEbxuRh.js";import"./index.33C-WVq8.js";import"./refs.Cw5r5QN8.js";import"./pagination.BP_3TcMH.js";import"./select.CbuXqiqO.js";import"./index.DB7b8zJj.js";import"./strings.CuGzRR0G.js";import"./castArray.DwIa-ddT.js";import"./index.BM1Y5O9s.js";import"./debounce.BSbgIsNH.js";import"./toNumber.CTKVBeqF.js";import"./_baseIteratee.Bz4YUaFH.js";import"./index.ChhW_Tvf.js";import"./_plugin-vue_export-helper.BCo6x5W8.js";import"./_initCloneObject.D6_TlKeT.js";import"./raf.UU1-UmoM.js";import"./_baseClone.C_H9MAg3.js";import"./index.DUp9k36Z.js";const M={class:"app-container"},q={class:"search-container"},B={class:"data-table__toolbar"},K={class:"data-table__toolbar--actions"},$={class:"dialog-footer"},Q={class:"flex-x-between"},W={class:"flex-center ml-5"},Y={class:"dialog-footer"},Z=e({name:"Roles",inheritAttrs:!1,__name:"Index",setup(e){const Z=a(),J=l(),L=l(),X=l(!1),H=l([]),ee=l(0),ae=t({page:1,per_page:10}),le=l(),te=t({title:"",visible:!1}),oe=t({}),ie=t({name:[{required:!0,message:"Please enter name",trigger:"blur"}],guard_name:[{required:!0,message:"Please enter guard name",trigger:"blur"}]});async function se(){X.value=!0;try{const e=await P.fetchRoles(ae);le.value=e.data,ee.value=e.meta.total}catch(e){}finally{X.value=!1}}function re(){ae.page=Number(ae.page)||1,se()}function ne(){J.value?.resetFields?.(),ae.page=1,se()}function de(e){H.value=e.map(e=>e.id)}function ue(e){te.visible=!0,e?(te.title="Edit Role",P.getRole(e).then(e=>{Object.assign(oe,e.data)})):(te.title="Add Role",Object.keys(oe).forEach(e=>oe[e]=void 0))}function me(){L.value.validate(e=>{if(e){X.value=!0;const e=oe.id;e?P.updateRole(e,oe).then(()=>{x.success("Updated successful"),ce(),re()}).finally(()=>X.value=!1):P.createRole(oe).then(()=>{x.success("Created successful"),ce(),se()}).finally(()=>X.value=!1)}})}function ce(){te.visible=!1,L.value.resetFields(),L.value.clearValidate(),oe.id=void 0}function pe(e){const a=void 0!==e?[e]:H.value;a&&0!==a.length?T.confirm("Are you sure to delete the selected item(s)?","WARNING",{confirmButtonText:"Confirm",cancelButtonText:"Cancel",type:"warning"}).then(async()=>{X.value=!0;try{await P.bulkDeleteRoles(a),x.success("Deleted successful"),re()}catch(e){x.error("Failed to delete role(s)")}finally{X.value=!1}},()=>{x.info("Deletion Cancelled")}):x.warning("Please select item(s)")}const fe=l(),ve=l([]),ge=o(()=>Z.device===i.DESKTOP?"600px":"90%"),_e=l({}),be=l(!1),je=l(""),he=l(!0),ye=l(!0);function ke(){const e=_e.value.id;if(e){const a=fe.value.getCheckedNodes(!1,!0).map(e=>e.value);X.value=!0,P.updateRoleMenus(e,a).then(()=>{x.success("分配权限成功"),be.value=!1,ne()}).finally(()=>{X.value=!1})}}function xe(){he.value=!he.value,fe.value&&Object.values(fe.value.store.nodesMap).forEach(e=>{he.value?e.expand():e.collapse()})}function Ce(e,a){return!e||a.label.includes(e)}function Ve(e){ye.value=e}return s(je,e=>{fe.value.filter(e)}),r(se),(e,a)=>{const l=O,t=F,o=G,i=I,s=z,r=S,x=D,T=A,Z=N,Ee=n("Search"),we=n("Switch"),Re=R,Ue=n("QuestionFilled"),Ne=k,Ae=U,De=w,Se=E,ze=V;return u(),d("div",M,[m("div",q,[c(i,{ref_key:"queryFormRef",ref:J,model:v(ae),inline:!0},{default:p(()=>[c(t,{prop:"name",label:"Name"},{default:p(()=>[c(l,{modelValue:v(ae).name,"onUpdate:modelValue":a[0]||(a[0]=e=>v(ae).name=e),placeholder:"Enter name",clearable:"",onKeyup:f(re,["enter"])},null,8,["modelValue"])]),_:1}),c(t,{prop:"guard_name",label:"Guard Name"},{default:p(()=>[c(l,{modelValue:v(ae).guard_name,"onUpdate:modelValue":a[1]||(a[1]=e=>v(ae).guard_name=e),placeholder:"Enter guard name",clearable:"",onKeyup:f(re,["enter"])},null,8,["modelValue"])]),_:1}),c(t,{class:"search-buttons"},{default:p(()=>[c(o,{type:"primary",icon:"search",onClick:re},{default:p(()=>[...a[14]||(a[14]=[g("Search",-1)])]),_:1}),c(o,{icon:"refresh",onClick:ne},{default:p(()=>[...a[15]||(a[15]=[g("Reset",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),c(T,{shadow:"hover",class:"data-table"},{default:p(()=>[m("div",B,[m("div",K,[c(o,{type:"success",icon:"plus",onClick:a[2]||(a[2]=e=>ue())},{default:p(()=>[...a[16]||(a[16]=[g("Add",-1)])]),_:1}),c(o,{type:"danger",disabled:0===v(H).length,icon:"delete",onClick:a[3]||(a[3]=e=>pe())},{default:p(()=>[...a[17]||(a[17]=[g(" Delete ",-1)])]),_:1},8,["disabled"])])]),_((u(),b(r,{ref:"dataTableRef",data:v(le),"highlight-current-row":"",border:"",class:"data-table__content",onSelectionChange:de},{default:p(()=>[c(s,{type:"selection",width:"55",align:"center"}),c(s,{label:"ID",prop:"id"}),c(s,{label:"Name",prop:"name"}),c(s,{label:"Guard Name",prop:"guard_name"}),c(s,{label:"Label",prop:"label"}),c(s,{fixed:"right",label:"Actions",width:"240"},{default:p(e=>[c(o,{type:"primary",size:"small",link:"",icon:"position",onClick:a=>async function(e){const a=e.id;if(a){be.value=!0,X.value=!0,_e.value.id=a,_e.value.name=e.name;const l=await C.getOptions();ve.value=l.data,P.getRoleMenuIds(a).then(e=>{e.data.forEach(e=>fe.value.setChecked(e,!0,!1))}).finally(()=>{X.value=!1})}}(e.row)},{default:p(()=>[...a[18]||(a[18]=[g(" Permissions ",-1)])]),_:1},8,["onClick"]),c(o,{type:"primary",size:"small",link:"",icon:"edit",onClick:a=>ue(e.row.id)},{default:p(()=>[...a[19]||(a[19]=[g(" Edit ",-1)])]),_:1},8,["onClick"]),c(o,{type:"danger",size:"small",link:"",icon:"delete",onClick:a=>pe(e.row.id)},{default:p(()=>[...a[20]||(a[20]=[g(" Delete ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ze,v(X)]]),v(ee)>0?(u(),b(x,{key:0,total:v(ee),"onUpdate:total":a[4]||(a[4]=e=>h(ee)?ee.value=e:null),page:v(ae).page,"onUpdate:page":a[5]||(a[5]=e=>v(ae).page=e),limit:v(ae).per_page,"onUpdate:limit":a[6]||(a[6]=e=>v(ae).per_page=e),onPagination:se},null,8,["total","page","limit"])):j("",!0)]),_:1}),c(Z,{modelValue:v(te).visible,"onUpdate:modelValue":a[9]||(a[9]=e=>v(te).visible=e),title:v(te).title,width:"500px",onClose:ce},{footer:p(()=>[m("div",$,[c(o,{type:"primary",onClick:me},{default:p(()=>[...a[21]||(a[21]=[g("Submit",-1)])]),_:1}),c(o,{onClick:ce},{default:p(()=>[...a[22]||(a[22]=[g("Cancel",-1)])]),_:1})])]),default:p(()=>[c(i,{ref_key:"roleFormRef",ref:L,model:v(oe),rules:v(ie),"label-width":"100px"},{default:p(()=>[c(t,{label:"Name",prop:"name"},{default:p(()=>[c(l,{modelValue:v(oe).name,"onUpdate:modelValue":a[7]||(a[7]=e=>v(oe).name=e),placeholder:"Enter name"},null,8,["modelValue"])]),_:1}),c(t,{label:"Guard",prop:"guard_name"},{default:p(()=>[c(l,{modelValue:v(oe).guard_name,"onUpdate:modelValue":a[8]||(a[8]=e=>v(oe).guard_name=e),placeholder:"Enter guard name"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),c(Se,{modelValue:v(be),"onUpdate:modelValue":a[13]||(a[13]=e=>h(be)?be.value=e:null),title:"【"+v(_e).name+"】权限分配",size:v(ge)},{footer:p(()=>[m("div",Y,[c(o,{type:"primary",onClick:ke},{default:p(()=>[...a[25]||(a[25]=[g("确 定",-1)])]),_:1}),c(o,{onClick:a[12]||(a[12]=e=>be.value=!1)},{default:p(()=>[...a[26]||(a[26]=[g("取 消",-1)])]),_:1})])]),default:p(()=>[m("div",Q,[c(l,{modelValue:v(je),"onUpdate:modelValue":a[10]||(a[10]=e=>h(je)?je.value=e:null),clearable:"",class:"w-[150px]",placeholder:"菜单权限名称"},{prefix:p(()=>[c(Ee)]),_:1},8,["modelValue"]),m("div",W,[c(o,{type:"primary",size:"small",plain:"",onClick:xe},{icon:p(()=>[c(we)]),default:p(()=>[g(" "+y(v(he)?"收缩":"展开"),1)]),_:1}),c(Re,{modelValue:v(ye),"onUpdate:modelValue":a[11]||(a[11]=e=>h(ye)?ye.value=e:null),class:"ml-5",onChange:Ve},{default:p(()=>[...a[23]||(a[23]=[g(" 父子联动 ",-1)])]),_:1},8,["modelValue"]),c(Ae,{placement:"bottom"},{content:p(()=>[...a[24]||(a[24]=[g(" 如果只需勾选菜单权限，不需要勾选子菜单或者按钮权限，请关闭父子联动 ",-1)])]),default:p(()=>[c(Ne,{class:"ml-1 color-[--el-color-primary] inline-block cursor-pointer"},{default:p(()=>[c(Ue)]),_:1})]),_:1})])]),c(De,{ref_key:"permTreeRef",ref:fe,"node-key":"value","show-checkbox":"",data:v(ve),"filter-node-method":Ce,"default-expand-all":!0,"check-strictly":!v(ye),class:"mt-5"},{default:p(({data:e})=>[g(y(e.label),1)]),_:1},8,["data","check-strictly"])]),_:1},8,["modelValue","title","size"])])}}});export{Z as default};
