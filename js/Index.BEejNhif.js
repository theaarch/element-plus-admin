import{d as e,aJ as a,al as l,r as t,S as o,c as r,ar as s,o as i,bO as d,g as n,f as u,m as p,w as m,i as c,C as f,a3 as g,a4 as _,$ as b,e as j,h as v,F as h,aA as y,P as V,Q as w,dK as x,bc as k,aG as U}from"./index.DPjeb2zQ.js";import{v as C}from"./loading.DyGMxJ3X.js";import{E as I}from"./drawer.C6tc4vW_.js";import"./overlay.DAjljUwT.js";import{E}from"./switch.DJbfXsyS.js";import{_ as z}from"./index.vue_vue_type_script_setup_true_lang.CASauKhv.js";/* empty css            */import{E as T,a as R}from"./select.C4df3Kkp.js";import"./scrollbar.DOddSew1.js";import"./popper.Dm16IEPc.js";import"./tree.CZWtuwJV.js";import"./checkbox.B5Bkj-h_.js";import"./text.rQMlwoKg.js";import{E as S}from"./tree-select.CARgpinA.js";import{a as N,E as D}from"./col.Bf0D2SjT.js";import{E as O}from"./card.BSEDd1oC.js";import{_ as A}from"./index.77vvSJsc.js";import{a as B,E as L}from"./table-column.DdOtTf0g.js";/* empty css                */import{_ as q}from"./DictLabel.vue_vue_type_script_setup_true_lang.K1pYqPmW.js";import{a as F,E as P}from"./form-item.-jzpDoAb.js";/* empty css               */import{E as Y}from"./date-picker-panel.Cc-ZP8WN.js";import{E as Z}from"./input.DlospnVm.js";import{D as $}from"./dept-api.Bl2sEwA7.js";import{R as K}from"./role-api.CDdcQ4NA.js";import{_ as M}from"./DeptTree.vue_vue_type_script_setup_true_lang.CCHAad_J.js";import{_ as J}from"./UserImport.vue_vue_type_script_setup_true_lang.CkOkPsCm.js";/* empty css                    */import{E as Q}from"./index.DH6J2NRu.js";import{E as G}from"./index.DR23hhGw.js";import{E as W}from"./index.D2eZGFfC.js";import"./index.D_xIadxN.js";import"./aria.Cpd_B0tV.js";import"./index.BHbOdqtI.js";import"./vnode.WhZAtndn.js";import"./event.BwRzfsZt.js";import"./error.D_Dr4eZ1.js";import"./scroll.Com_nA0Y.js";import"./use-form-common-props.CgvSsgho.js";import"./index.DcDgPnly.js";/* empty css                       */import"./radio-group.B5C7S3s1.js";import"./token.DWNpOE8r.js";import"./strings.niQPwILk.js";import"./castArray.Cp0SJt3o.js";import"./index.BQ7Zw0pD.js";import"./debounce.BCFaBayH.js";import"./toNumber.BDvkOwGB.js";import"./_baseIteratee.NeA0DMvh.js";import"./index.B8SGLsTu.js";import"./index.BxbxyEDr.js";import"./index.CpwIu_pC.js";import"./pagination.DKqjYaTo.js";import"./_plugin-vue_export-helper.BCo6x5W8.js";import"./_initCloneObject.DysrxiJA.js";import"./raf.chweMVaG.js";import"./_baseClone.BReLIpKR.js";import"./dayjs.min.CSMFvwDr.js";import"./index.iXkc3L6A.js";import"./index.DnzmRk-s.js";import"./alert.CFB3wI_U.js";import"./dialog.IQ-lvpYP.js";import"./refs.Cw5r5QN8.js";import"./upload.DkrCHoTr.js";import"./progress.l-yYQrUO.js";import"./link.Cv485RLe.js";const X={class:"app-container"},H={class:"search-container"},ee={class:"data-table__toolbar"},ae={class:"data-table__toolbar--actions"},le={class:"data-table__toolbar--tools"},te={class:"dialog-footer"},oe=e({name:"User",inheritAttrs:!1,__name:"Index",setup(e){const oe=a(),re=l(),se=t(),ie=t(),de=o({pageNum:1,pageSize:10}),ne=t(),ue=t(0),pe=t(!1),me=o({visible:!1,title:"新增用户"}),ce=r(()=>re.device===s.DESKTOP?"600px":"90%"),fe=o({status:1}),ge=o({username:[{required:!0,message:"用户名不能为空",trigger:"blur"}],nickname:[{required:!0,message:"用户昵称不能为空",trigger:"blur"}],deptId:[{required:!0,message:"所属部门不能为空",trigger:"blur"}],roleIds:[{required:!0,message:"用户角色不能为空",trigger:"blur"}],email:[{pattern:/\w[-\w.+]*@([A-Za-z0-9][-A-Za-z0-9]+\.)+[A-Za-z]{2,14}/,message:"请输入正确的邮箱地址",trigger:"blur"}],mobile:[{pattern:/^1[3|4|5|6|7|8|9][0-9]\d{8}$/,message:"请输入正确的手机号码",trigger:"blur"}]}),_e=t([]),be=t(),je=t(),ve=t(!1);async function he(){pe.value=!0;try{const e=await k.getPage(de);ne.value=e.list,ue.value=e.total}finally{pe.value=!1}}function ye(){de.pageNum=1,he()}function Ve(){se.value.resetFields(),de.pageNum=1,de.deptId=void 0,de.createTime=void 0,he()}function we(e){_e.value=e.map(e=>e.id)}async function xe(e){me.visible=!0,je.value=await K.getOptions(),be.value=await $.getOptions(),e?(me.title="修改用户",k.getFormData(e).then(e=>{Object.assign(fe,{...e})})):me.title="新增用户"}function ke(){me.visible=!1,ie.value.resetFields(),ie.value.clearValidate(),fe.id=void 0,fe.status=1}const Ue=x(()=>{ie.value.validate(e=>{if(e){const e=fe.id;pe.value=!0,e?k.update(e,fe).then(()=>{U.success("修改用户成功"),ke(),Ve()}).finally(()=>pe.value=!1):k.create(fe).then(()=>{U.success("新增用户成功"),ke(),Ve()}).finally(()=>pe.value=!1)}})},1e3);function Ce(e){const a=[e||_e.value].join(",");if(!a)return void U.warning("请勾选删除项");const l=oe.userInfo;!function(e,a=[],l){return!!l?.userId&&(!(!e||e.toString()!==l.userId)||!e&&a.length>0&&a.map(String).includes(l.userId))}(e,_e.value,l)?W.confirm("确认删除用户?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{pe.value=!0,k.deleteByIds(a).then(()=>{U.success("删除成功"),Ve()}).finally(()=>pe.value=!1)},()=>{U.info("已取消删除")}):U.error("不能删除当前登录用户")}function Ie(){ve.value=!0}function Ee(){k.export(de).then(e=>{const a=e.data,l=decodeURI(e.headers["content-disposition"].split(";")[1].split("=")[1]),t=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=utf-8"}),o=window.URL.createObjectURL(t),r=document.createElement("a");r.href=o,r.download=l,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(o)})}return i(()=>{ye()}),(e,a)=>{const l=N,t=Z,o=P,r=R,s=T,i=Y,x=Q,$=F,K=L,oe=q,re=G,ze=B,Te=A,Re=O,Se=D,Ne=S,De=z,Oe=E,Ae=I,Be=d("hasPerm"),Le=C;return u(),n("div",X,[p(Se,{gutter:20},{default:m(()=>[p(l,{lg:4,xs:24,class:"mb-[12px]"},{default:m(()=>[p(M,{modelValue:c(de).deptId,"onUpdate:modelValue":a[0]||(a[0]=e=>c(de).deptId=e),onNodeClick:ye},null,8,["modelValue"])]),_:1}),p(l,{lg:20,xs:24},{default:m(()=>[f("div",H,[p($,{ref_key:"queryFormRef",ref:se,model:c(de),inline:!0,"label-width":"auto"},{default:m(()=>[p(o,{label:"关键字",prop:"keywords"},{default:m(()=>[p(t,{modelValue:c(de).keywords,"onUpdate:modelValue":a[1]||(a[1]=e=>c(de).keywords=e),placeholder:"用户名/昵称/手机号",clearable:"",onKeyup:g(ye,["enter"])},null,8,["modelValue"])]),_:1}),p(o,{label:"状态",prop:"status"},{default:m(()=>[p(s,{modelValue:c(de).status,"onUpdate:modelValue":a[2]||(a[2]=e=>c(de).status=e),placeholder:"全部",clearable:"",style:{width:"100px"}},{default:m(()=>[p(r,{label:"正常",value:1}),p(r,{label:"禁用",value:0})]),_:1},8,["modelValue"])]),_:1}),p(o,{label:"创建时间"},{default:m(()=>[p(i,{modelValue:c(de).createTime,"onUpdate:modelValue":a[3]||(a[3]=e=>c(de).createTime=e),editable:!1,type:"daterange","range-separator":"~","start-placeholder":"开始时间","end-placeholder":"截止时间","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),p(o,{class:"search-buttons"},{default:m(()=>[p(x,{type:"primary",icon:"search",onClick:ye},{default:m(()=>[...a[20]||(a[20]=[_("搜索",-1)])]),_:1}),p(x,{icon:"refresh",onClick:Ve},{default:m(()=>[...a[21]||(a[21]=[_("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),p(Re,{shadow:"hover",class:"data-table"},{default:m(()=>[f("div",ee,[f("div",ae,[b((u(),j(x,{type:"success",icon:"plus",onClick:a[4]||(a[4]=e=>xe())},{default:m(()=>[...a[22]||(a[22]=[_(" 新增 ",-1)])]),_:1})),[[Be,["sys:user:add"]]]),b((u(),j(x,{type:"danger",icon:"delete",disabled:0===c(_e).length,onClick:a[5]||(a[5]=e=>Ce())},{default:m(()=>[...a[23]||(a[23]=[_(" 删除 ",-1)])]),_:1},8,["disabled"])),[[Be,"sys:user:delete"]])]),f("div",le,[b((u(),j(x,{icon:"upload",onClick:Ie},{default:m(()=>[...a[24]||(a[24]=[_(" 导入 ",-1)])]),_:1})),[[Be,"sys:user:import"]]),b((u(),j(x,{icon:"download",onClick:Ee},{default:m(()=>[...a[25]||(a[25]=[_(" 导出 ",-1)])]),_:1})),[[Be,"sys:user:export"]])])]),b((u(),j(ze,{data:c(ne),border:"",stripe:"","highlight-current-row":"",class:"data-table__content",onSelectionChange:we},{default:m(()=>[p(K,{type:"selection",width:"50",align:"center"}),p(K,{label:"用户名",prop:"username"}),p(K,{label:"昵称",width:"150",align:"center",prop:"nickname"}),p(K,{label:"性别",width:"100",align:"center"},{default:m(e=>[p(oe,{modelValue:e.row.gender,"onUpdate:modelValue":a=>e.row.gender=a,code:"gender"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),p(K,{label:"部门",width:"120",align:"center",prop:"deptName"}),p(K,{label:"手机号码",align:"center",prop:"mobile",width:"120"}),p(K,{label:"邮箱",align:"center",prop:"email",width:"160"}),p(K,{label:"状态",align:"center",prop:"status",width:"80"},{default:m(e=>[p(re,{type:1==e.row.status?"success":"info"},{default:m(()=>[_(h(1==e.row.status?"正常":"禁用"),1)]),_:2},1032,["type"])]),_:1}),p(K,{label:"创建时间",align:"center",prop:"createTime",width:"150"}),p(K,{label:"操作",fixed:"right",width:"220"},{default:m(e=>[b((u(),j(x,{type:"primary",icon:"RefreshLeft",size:"small",link:"",onClick:a=>{return l=e.row,void W.prompt("请输入用户【"+l.username+"】的新密码","重置密码",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(({value:e})=>{if(!e||e.length<6)return U.warning("密码至少需要6位字符，请重新输入"),!1;k.resetPassword(l.id,e).then(()=>{U.success("密码重置成功，新密码是："+e)})},()=>{U.info("已取消重置密码")});var l}},{default:m(()=>[...a[26]||(a[26]=[_(" 重置密码 ",-1)])]),_:1},8,["onClick"])),[[Be,"sys:user:reset-password"]]),b((u(),j(x,{type:"primary",icon:"edit",link:"",size:"small",onClick:a=>xe(e.row.id)},{default:m(()=>[...a[27]||(a[27]=[_(" 编辑 ",-1)])]),_:1},8,["onClick"])),[[Be,"sys:user:edit"]]),b((u(),j(x,{type:"danger",icon:"delete",link:"",size:"small",onClick:a=>Ce(e.row.id)},{default:m(()=>[...a[28]||(a[28]=[_(" 删除 ",-1)])]),_:1},8,["onClick"])),[[Be,"sys:user:delete"]])]),_:1})]),_:1},8,["data"])),[[Le,c(pe)]]),c(ue)>0?(u(),j(Te,{key:0,total:c(ue),"onUpdate:total":a[6]||(a[6]=e=>y(ue)?ue.value=e:null),page:c(de).pageNum,"onUpdate:page":a[7]||(a[7]=e=>c(de).pageNum=e),limit:c(de).pageSize,"onUpdate:limit":a[8]||(a[8]=e=>c(de).pageSize=e),onPagination:he},null,8,["total","page","limit"])):v("",!0)]),_:1})]),_:1})]),_:1}),p(Ae,{modelValue:c(me).visible,"onUpdate:modelValue":a[17]||(a[17]=e=>c(me).visible=e),title:c(me).title,"append-to-body":"",size:c(ce),onClose:ke},{footer:m(()=>[f("div",te,[p(x,{type:"primary",onClick:c(Ue)},{default:m(()=>[...a[29]||(a[29]=[_("确 定",-1)])]),_:1},8,["onClick"]),p(x,{onClick:ke},{default:m(()=>[...a[30]||(a[30]=[_("取 消",-1)])]),_:1})])]),default:m(()=>[p($,{ref_key:"userFormRef",ref:ie,model:c(fe),rules:c(ge),"label-width":"80px"},{default:m(()=>[p(o,{label:"用户名",prop:"username"},{default:m(()=>[p(t,{modelValue:c(fe).username,"onUpdate:modelValue":a[9]||(a[9]=e=>c(fe).username=e),readonly:!!c(fe).id,placeholder:"请输入用户名"},null,8,["modelValue","readonly"])]),_:1}),p(o,{label:"用户昵称",prop:"nickname"},{default:m(()=>[p(t,{modelValue:c(fe).nickname,"onUpdate:modelValue":a[10]||(a[10]=e=>c(fe).nickname=e),placeholder:"请输入用户昵称"},null,8,["modelValue"])]),_:1}),p(o,{label:"所属部门",prop:"deptId"},{default:m(()=>[p(Ne,{modelValue:c(fe).deptId,"onUpdate:modelValue":a[11]||(a[11]=e=>c(fe).deptId=e),placeholder:"请选择所属部门",data:c(be),filterable:"","check-strictly":"","render-after-expand":!1},null,8,["modelValue","data"])]),_:1}),p(o,{label:"性别",prop:"gender"},{default:m(()=>[p(De,{modelValue:c(fe).gender,"onUpdate:modelValue":a[12]||(a[12]=e=>c(fe).gender=e),code:"gender"},null,8,["modelValue"])]),_:1}),p(o,{label:"角色",prop:"roleIds"},{default:m(()=>[p(s,{modelValue:c(fe).roleIds,"onUpdate:modelValue":a[13]||(a[13]=e=>c(fe).roleIds=e),multiple:"",placeholder:"请选择"},{default:m(()=>[(u(!0),n(V,null,w(c(je),e=>(u(),j(r,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),p(o,{label:"手机号码",prop:"mobile"},{default:m(()=>[p(t,{modelValue:c(fe).mobile,"onUpdate:modelValue":a[14]||(a[14]=e=>c(fe).mobile=e),placeholder:"请输入手机号码",maxlength:"11"},null,8,["modelValue"])]),_:1}),p(o,{label:"邮箱",prop:"email"},{default:m(()=>[p(t,{modelValue:c(fe).email,"onUpdate:modelValue":a[15]||(a[15]=e=>c(fe).email=e),placeholder:"请输入邮箱",maxlength:"50"},null,8,["modelValue"])]),_:1}),p(o,{label:"状态",prop:"status"},{default:m(()=>[p(Oe,{modelValue:c(fe).status,"onUpdate:modelValue":a[16]||(a[16]=e=>c(fe).status=e),"inline-prompt":"","active-text":"正常","inactive-text":"禁用","active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title","size"]),p(J,{modelValue:c(ve),"onUpdate:modelValue":a[18]||(a[18]=e=>y(ve)?ve.value=e:null),onImportSuccess:a[19]||(a[19]=e=>ye())},null,8,["modelValue"])])}}});export{oe as default};
