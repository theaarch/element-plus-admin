import{d as e,al as l,r as a,S as t,c as o,ar as r,o as s,as as i,bR as d,g as n,f as u,C as p,m,w as c,a3 as f,i as y,a4 as v,$ as _,e as h,h as b,E as k,D as g,n as V,F as j,j as w,br as U,P as x,Q as E,bn as N,aG as C}from"./index.DxBlw8vg.js";import{v as T}from"./loading.CELi8sBE.js";import{E as A}from"./drawer.DHS2Ut9C.js";import"./overlay.CY0o-B_X.js";import{_ as O}from"./index.BeNR0Nti.js";import{E as L}from"./input.Bbblo3Jz.js";import{E as M}from"./input-number.Cuty9jbI.js";/* empty css                */import{E as P}from"./popper.BcYqVa6G.js";import{E as I,a as G}from"./radio-group.BG0vamtg.js";/* empty css            */import"./select.Cowqo2Bl.js";import"./scrollbar.Cl6Q0ztM.js";import"./tree.CH8mvd5f.js";import"./checkbox.5qa5TXQf.js";import"./text.IVw3pTnl.js";import{E as B}from"./tree-select.9oTMhQkU.js";import{E as q}from"./card.CG3bsDKl.js";import{a as F,E as S}from"./table-column.Dpydc78B.js";import{E as R,a as K}from"./form-item.DDiGHb0r.js";/* empty css               *//* empty css                    */import{E as z}from"./index.KYpUS13f.js";import{E as X}from"./index.BMBoAU03.js";import{E as D}from"./index.DQ0O3_yC.js";import"./index.RtRn6W4u.js";import"./aria.Cpd_B0tV.js";import"./index.BP_sdoaf.js";import"./vnode.iaPv8UR0.js";import"./event.BwRzfsZt.js";import"./error.D_Dr4eZ1.js";import"./scroll.CFi2rm1x.js";import"./use-form-common-props.D4_6zUCF.js";import"./popover.Byd70v85.js";import"./dropdown.C8niYQ9y.js";import"./tab-pane.D9f7qHuB.js";import"./raf.1exHiZ7S.js";import"./_initCloneObject.BYc1Qx2n.js";import"./strings.NpL5U0Vf.js";import"./toNumber.CmdCAqzi.js";import"./index.D4kWfsUP.js";import"./_baseClone.C4yMf0XY.js";import"./index.DXHChytE.js";import"./_plugin-vue_export-helper.BCo6x5W8.js";import"./index.BGxDQnMU.js";import"./index.d54sfuhG.js";import"./index.DsDNoN7p.js";import"./index.6ggUxvGz.js";import"./token.DWNpOE8r.js";import"./castArray.DB3pNMqC.js";import"./debounce.tLdHjYAo.js";import"./_baseIteratee.BaNRUkDj.js";import"./index.CO5RZek8.js";import"./index.D4JiyVhP.js";var Q=(e=>(e[e.CATALOG=2]="CATALOG",e[e.MENU=1]="MENU",e[e.BUTTON=4]="BUTTON",e[e.EXTLINK=3]="EXTLINK",e))(Q||{});const W={class:"app-container"},$={class:"search-container"},J={class:"data-table__toolbar"},Y={class:"data-table__toolbar--actions"},Z={class:"flex-y-center"},H={class:"flex-y-center"},ee={class:"flex-y-center"},le={class:"flex-y-center"},ae={key:0},te={key:1},oe={class:"flex-y-center"},re={class:"dialog-footer"},se=e({name:"SysMenu",inheritAttrs:!1,__name:"index",setup(e){const se=l(),ie=a(),de=a(),ne=a(!1),ue=t({title:"新增菜单",visible:!1}),pe=o(()=>se.device===r.DESKTOP?"600px":"90%"),me=t({}),ce=a([]),fe=a([]),ye=a({id:void 0,parentId:"0",visible:1,sort:1,type:Q.MENU,alwaysShow:0,keepAlive:1,params:[]}),ve=a({...ye.value}),_e=t({parentId:[{required:!0,message:"请选择父级菜单",trigger:"blur"}],name:[{required:!0,message:"请输入菜单名称",trigger:"blur"}],type:[{required:!0,message:"请选择菜单类型",trigger:"blur"}],routeName:[{required:!0,message:"请输入路由名称",trigger:"blur"}],routePath:[{required:!0,message:"请输入路由路径",trigger:"blur"}],component:[{required:!0,message:"请输入组件路径",trigger:"blur"}],visible:[{required:!0,message:"请选择显示状态",trigger:"change"}]}),he=a();function be(){ne.value=!0,N.getList(me).then(e=>{const l=e.data;ce.value=l}).finally(()=>{ne.value=!1})}function ke(){ie.value.resetFields(),be()}function ge(e){he.value=e.id}function Ve(e,l){N.getOptions(!0).then(e=>{const l=e.data;fe.value=[{value:"0",label:"顶级菜单",children:l}]}).then(()=>{ue.visible=!0,l?(ue.title="编辑菜单",N.getFormData(l).then(e=>{const l=e.data;ye.value={...l},ve.value=l})):(ue.title="新增菜单",ve.value.parentId=e?.toString())})}function je(){ve.value.type!==ye.value.type&&ve.value.type===Q.MENU&&(ye.value.type===Q.CATALOG?ve.value.component="":(ve.value.routePath=ye.value.routePath,ve.value.component=ye.value.component))}function we(){de.value.validate(e=>{if(e){const e=ve.value.id;if(e){if(ve.value.parentId==e)return void C.error("父级菜单不能为当前菜单");N.update(e,ve.value).then(()=>{C.success("修改成功"),Ue(),be()})}else N.create(ve.value).then(()=>{C.success("新增成功"),Ue(),be()})}})}function Ue(){ue.visible=!1,de.value.resetFields(),de.value.clearValidate(),ve.value={id:void 0,parentId:"0",visible:1,sort:1,type:Q.MENU,alwaysShow:0,keepAlive:1,params:[]}}return s(()=>{be()}),(e,l)=>{const a=L,t=R,o=z,r=K,s=k,se=S,ye=X,he=F,xe=q,Ee=B,Ne=G,Ce=I,Te=i("QuestionFilled"),Ae=P,Oe=i("CirclePlusFilled"),Le=i("DeleteFilled"),Me=M,Pe=O,Ie=A,Ge=d("hasPerm"),Be=T;return u(),n("div",W,[p("div",$,[m(r,{ref_key:"queryFormRef",ref:ie,model:y(me),inline:!0},{default:c(()=>[m(t,{label:"关键字",prop:"keywords"},{default:c(()=>[m(a,{modelValue:y(me).keywords,"onUpdate:modelValue":l[0]||(l[0]=e=>y(me).keywords=e),placeholder:"菜单名称",clearable:"",onKeyup:f(be,["enter"])},null,8,["modelValue"])]),_:1}),m(t,{class:"search-buttons"},{default:c(()=>[m(o,{type:"primary",icon:"search",onClick:be},{default:c(()=>[...l[20]||(l[20]=[v("搜索",-1)])]),_:1}),m(o,{icon:"refresh",onClick:ke},{default:c(()=>[...l[21]||(l[21]=[v("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),m(xe,{shadow:"hover",class:"data-table"},{default:c(()=>[p("div",J,[p("div",Y,[_((u(),h(o,{type:"success",icon:"plus",onClick:l[1]||(l[1]=e=>Ve("0"))},{default:c(()=>[...l[22]||(l[22]=[v(" 新增 ",-1)])]),_:1})),[[Ge,["sys:menu:add"]]])])]),_((u(),h(he,{ref:"dataTableRef","row-key":"id",data:y(ce),"tree-props":{children:"children",hasChildren:"hasChildren"},class:"data-table__content",onRowClick:ge},{default:c(()=>[m(se,{label:"菜单名称","min-width":"200"},{default:c(e=>[e.row.icon&&e.row.icon.startsWith("el-icon")?(u(),h(s,{key:0,style:{"vertical-align":"-0.15em"}},{default:c(()=>[(u(),h(g(e.row.icon.replace("el-icon-",""))))]),_:2},1024)):e.row.icon?(u(),n("div",{key:1,class:V(`i-svg:${e.row.icon}`)},null,2)):b("",!0),v(" "+j(e.row.name),1)]),_:1}),m(se,{label:"类型",align:"center",width:"80"},{default:c(e=>[e.row.type===y(Q).CATALOG?(u(),h(ye,{key:0,type:"warning"},{default:c(()=>[...l[23]||(l[23]=[v("目录",-1)])]),_:1})):b("",!0),e.row.type===y(Q).MENU?(u(),h(ye,{key:1,type:"success"},{default:c(()=>[...l[24]||(l[24]=[v("菜单",-1)])]),_:1})):b("",!0),e.row.type===y(Q).BUTTON?(u(),h(ye,{key:2,type:"danger"},{default:c(()=>[...l[25]||(l[25]=[v("按钮",-1)])]),_:1})):b("",!0),e.row.type===y(Q).EXTLINK?(u(),h(ye,{key:3,type:"info"},{default:c(()=>[...l[26]||(l[26]=[v("外链",-1)])]),_:1})):b("",!0)]),_:1}),m(se,{label:"路由名称",align:"left",width:"150",prop:"routeName"}),m(se,{label:"路由路径",align:"left",width:"150",prop:"routePath"}),m(se,{label:"组件路径",align:"left",width:"250",prop:"component"}),m(se,{label:"权限标识",align:"center",width:"200",prop:"perm"}),m(se,{label:"状态",align:"center",width:"80"},{default:c(e=>[1===e.row.visible?(u(),h(ye,{key:0,type:"success"},{default:c(()=>[...l[27]||(l[27]=[v("显示",-1)])]),_:1})):(u(),h(ye,{key:1,type:"info"},{default:c(()=>[...l[28]||(l[28]=[v("隐藏",-1)])]),_:1}))]),_:1}),m(se,{label:"排序",align:"center",width:"80",prop:"sort"}),m(se,{fixed:"right",align:"center",label:"操作",width:"220"},{default:c(e=>[e.row.type==y(Q).CATALOG||e.row.type==y(Q).MENU?_((u(),h(o,{key:0,type:"primary",link:"",size:"small",icon:"plus",onClick:w(l=>Ve(e.row.id),["stop"])},{default:c(()=>[...l[29]||(l[29]=[v(" 新增 ",-1)])]),_:1},8,["onClick"])),[[Ge,["sys:menu:add"]]]):b("",!0),_((u(),h(o,{type:"primary",link:"",size:"small",icon:"edit",onClick:w(l=>Ve(void 0,e.row.id),["stop"])},{default:c(()=>[...l[30]||(l[30]=[v(" 编辑 ",-1)])]),_:1},8,["onClick"])),[[Ge,["sys:menu:edit"]]]),_((u(),h(o,{type:"danger",link:"",size:"small",icon:"delete",onClick:w(l=>function(e){if(!e)return C.warning("请勾选删除项"),!1;D.confirm("确认删除已选中的数据项?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{ne.value=!0,N.deleteById(e).then(()=>{C.success("删除成功"),be()}).finally(()=>{ne.value=!1})},()=>{C.info("已取消删除")})}(e.row.id),["stop"])},{default:c(()=>[...l[31]||(l[31]=[v(" 删除 ",-1)])]),_:1},8,["onClick"])),[[Ge,["sys:menu:delete"]]])]),_:1})]),_:1},8,["data"])),[[Be,y(ne)]])]),_:1}),m(Ie,{modelValue:y(ue).visible,"onUpdate:modelValue":l[19]||(l[19]=e=>y(ue).visible=e),title:y(ue).title,size:y(pe),onClose:Ue},{footer:c(()=>[p("div",re,[m(o,{type:"primary",onClick:we},{default:c(()=>[...l[56]||(l[56]=[v("确 定",-1)])]),_:1}),m(o,{onClick:Ue},{default:c(()=>[...l[57]||(l[57]=[v("取 消",-1)])]),_:1})])]),default:c(()=>[m(r,{ref_key:"menuFormRef",ref:de,model:y(ve),rules:y(_e),"label-width":"100px"},{default:c(()=>[m(t,{label:"父级菜单",prop:"parentId"},{default:c(()=>[m(Ee,{modelValue:y(ve).parentId,"onUpdate:modelValue":l[2]||(l[2]=e=>y(ve).parentId=e),placeholder:"选择上级菜单",data:y(fe),filterable:"","check-strictly":"","render-after-expand":!1},null,8,["modelValue","data"])]),_:1}),m(t,{label:"菜单名称",prop:"name"},{default:c(()=>[m(a,{modelValue:y(ve).name,"onUpdate:modelValue":l[3]||(l[3]=e=>y(ve).name=e),placeholder:"请输入菜单名称"},null,8,["modelValue"])]),_:1}),m(t,{label:"菜单类型",prop:"type"},{default:c(()=>[m(Ce,{modelValue:y(ve).type,"onUpdate:modelValue":l[4]||(l[4]=e=>y(ve).type=e),onChange:je},{default:c(()=>[m(Ne,{value:y(Q).CATALOG},{default:c(()=>[...l[32]||(l[32]=[v("目录",-1)])]),_:1},8,["value"]),m(Ne,{value:y(Q).MENU},{default:c(()=>[...l[33]||(l[33]=[v("菜单",-1)])]),_:1},8,["value"]),m(Ne,{value:y(Q).BUTTON},{default:c(()=>[...l[34]||(l[34]=[v("按钮",-1)])]),_:1},8,["value"]),m(Ne,{value:y(Q).EXTLINK},{default:c(()=>[...l[35]||(l[35]=[v("外链",-1)])]),_:1},8,["value"])]),_:1},8,["modelValue"])]),_:1}),y(ve).type==y(Q).EXTLINK?(u(),h(t,{key:0,label:"外链地址",prop:"path"},{default:c(()=>[m(a,{modelValue:y(ve).routePath,"onUpdate:modelValue":l[5]||(l[5]=e=>y(ve).routePath=e),placeholder:"请输入外链完整路径"},null,8,["modelValue"])]),_:1})):b("",!0),y(ve).type==y(Q).MENU?(u(),h(t,{key:1,prop:"routeName"},{label:c(()=>[p("div",Z,[l[37]||(l[37]=v(" 路由名称 ",-1)),m(Ae,{placement:"bottom",effect:"light"},{content:c(()=>[...l[36]||(l[36]=[v(" 如果需要开启缓存，需保证页面 defineOptions 中的 name 与此处一致，建议使用驼峰。 ",-1)])]),default:c(()=>[m(s,{class:"ml-1 cursor-pointer"},{default:c(()=>[m(Te)]),_:1})]),_:1})])]),default:c(()=>[m(a,{modelValue:y(ve).routeName,"onUpdate:modelValue":l[6]||(l[6]=e=>y(ve).routeName=e),placeholder:"User"},null,8,["modelValue"])]),_:1})):b("",!0),y(ve).type==y(Q).CATALOG||y(ve).type==y(Q).MENU?(u(),h(t,{key:2,prop:"routePath"},{label:c(()=>[p("div",H,[l[39]||(l[39]=v(" 路由路径 ",-1)),m(Ae,{placement:"bottom",effect:"light"},{content:c(()=>[...l[38]||(l[38]=[v(" 定义应用中不同页面对应的 URL 路径，目录需以 / 开头，菜单项不用。例如：系统管理目录 /system，系统管理下的用户管理菜单 user。 ",-1)])]),default:c(()=>[m(s,{class:"ml-1 cursor-pointer"},{default:c(()=>[m(Te)]),_:1})]),_:1})])]),default:c(()=>[y(ve).type==y(Q).CATALOG?(u(),h(a,{key:0,modelValue:y(ve).routePath,"onUpdate:modelValue":l[7]||(l[7]=e=>y(ve).routePath=e),placeholder:"system"},null,8,["modelValue"])):(u(),h(a,{key:1,modelValue:y(ve).routePath,"onUpdate:modelValue":l[8]||(l[8]=e=>y(ve).routePath=e),placeholder:"user"},null,8,["modelValue"]))]),_:1})):b("",!0),y(ve).type==y(Q).MENU?(u(),h(t,{key:3,prop:"component"},{label:c(()=>[p("div",ee,[l[41]||(l[41]=v(" 组件路径 ",-1)),m(Ae,{placement:"bottom",effect:"light"},{content:c(()=>[...l[40]||(l[40]=[v(" 组件页面完整路径，相对于 src/views/，如 system/user/index，缺省后缀 .vue ",-1)])]),default:c(()=>[m(s,{class:"ml-1 cursor-pointer"},{default:c(()=>[m(Te)]),_:1})]),_:1})])]),default:c(()=>[m(a,{modelValue:y(ve).component,"onUpdate:modelValue":l[9]||(l[9]=e=>y(ve).component=e),placeholder:"system/user/index",style:{width:"95%"}},U({_:2},[y(ve).type==y(Q).MENU?{name:"prepend",fn:c(()=>[l[42]||(l[42]=v("src/views/",-1))]),key:"0"}:void 0,y(ve).type==y(Q).MENU?{name:"append",fn:c(()=>[l[43]||(l[43]=v(".vue",-1))]),key:"1"}:void 0]),1032,["modelValue"])]),_:1})):b("",!0),y(ve).type==y(Q).MENU?(u(),h(t,{key:4},{label:c(()=>[p("div",le,[l[45]||(l[45]=v(" 路由参数 ",-1)),m(Ae,{placement:"bottom",effect:"light"},{content:c(()=>[...l[44]||(l[44]=[v(" 组件页面使用 `useRoute().query.参数名` 获取路由参数值。 ",-1)])]),default:c(()=>[m(s,{class:"ml-1 cursor-pointer"},{default:c(()=>[m(Te)]),_:1})]),_:1})])]),default:c(()=>[y(ve).params&&0!==y(ve).params.length?(u(),n("div",te,[(u(!0),n(x,null,E(y(ve).params,(e,t)=>(u(),n("div",{key:t},[m(a,{modelValue:e.key,"onUpdate:modelValue":l=>e.key=l,placeholder:"参数名",style:{width:"100px"}},null,8,["modelValue","onUpdate:modelValue"]),l[47]||(l[47]=p("span",{class:"mx-1"},"=",-1)),m(a,{modelValue:e.value,"onUpdate:modelValue":l=>e.value=l,placeholder:"参数值",style:{width:"100px"}},null,8,["modelValue","onUpdate:modelValue"]),y(ve).params.indexOf(e)===y(ve).params.length-1?(u(),h(s,{key:0,class:"ml-2 cursor-pointer color-[var(--el-color-success)]",style:{"vertical-align":"-0.15em"},onClick:l[11]||(l[11]=e=>y(ve).params.push({key:"",value:""}))},{default:c(()=>[m(Oe)]),_:1})):b("",!0),m(s,{class:"ml-2 cursor-pointer color-[var(--el-color-danger)]",style:{"vertical-align":"-0.15em"},onClick:l=>y(ve).params.splice(y(ve).params.indexOf(e),1)},{default:c(()=>[m(Le)]),_:1},8,["onClick"])]))),128))])):(u(),n("div",ae,[m(o,{type:"success",plain:"",onClick:l[10]||(l[10]=e=>y(ve).params=[{key:"",value:""}])},{default:c(()=>[...l[46]||(l[46]=[v(" 添加路由参数 ",-1)])]),_:1})]))]),_:1})):b("",!0),y(ve).type!==y(Q).BUTTON?(u(),h(t,{key:5,prop:"visible",label:"显示状态"},{default:c(()=>[m(Ce,{modelValue:y(ve).visible,"onUpdate:modelValue":l[12]||(l[12]=e=>y(ve).visible=e)},{default:c(()=>[m(Ne,{value:1},{default:c(()=>[...l[48]||(l[48]=[v("显示",-1)])]),_:1}),m(Ne,{value:0},{default:c(()=>[...l[49]||(l[49]=[v("隐藏",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})):b("",!0),y(ve).type===y(Q).CATALOG||y(ve).type===y(Q).MENU?(u(),h(t,{key:6},{label:c(()=>[p("div",oe,[l[51]||(l[51]=v(" 始终显示 ",-1)),m(Ae,{placement:"bottom",effect:"light"},{content:c(()=>[...l[50]||(l[50]=[v(' 选择"是"，即使目录或菜单下只有一个子节点，也会显示父节点。 ',-1),p("br",null,null,-1),v(' 选择"否"，如果目录或菜单下只有一个子节点，则只显示该子节点，隐藏父节点。 ',-1),p("br",null,null,-1),v(' 如果是叶子节点，请选择"否"。 ',-1)])]),default:c(()=>[m(s,{class:"ml-1 cursor-pointer"},{default:c(()=>[m(Te)]),_:1})]),_:1})])]),default:c(()=>[m(Ce,{modelValue:y(ve).alwaysShow,"onUpdate:modelValue":l[13]||(l[13]=e=>y(ve).alwaysShow=e)},{default:c(()=>[m(Ne,{value:1},{default:c(()=>[...l[52]||(l[52]=[v("是",-1)])]),_:1}),m(Ne,{value:0},{default:c(()=>[...l[53]||(l[53]=[v("否",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})):b("",!0),y(ve).type===y(Q).MENU?(u(),h(t,{key:7,label:"缓存页面"},{default:c(()=>[m(Ce,{modelValue:y(ve).keepAlive,"onUpdate:modelValue":l[14]||(l[14]=e=>y(ve).keepAlive=e)},{default:c(()=>[m(Ne,{value:1},{default:c(()=>[...l[54]||(l[54]=[v("开启",-1)])]),_:1}),m(Ne,{value:0},{default:c(()=>[...l[55]||(l[55]=[v("关闭",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})):b("",!0),m(t,{label:"排序",prop:"sort"},{default:c(()=>[m(Me,{modelValue:y(ve).sort,"onUpdate:modelValue":l[15]||(l[15]=e=>y(ve).sort=e),style:{width:"100px"},"controls-position":"right",min:0},null,8,["modelValue"])]),_:1}),y(ve).type==y(Q).BUTTON?(u(),h(t,{key:8,label:"权限标识",prop:"perm"},{default:c(()=>[m(a,{modelValue:y(ve).perm,"onUpdate:modelValue":l[16]||(l[16]=e=>y(ve).perm=e),placeholder:"sys:user:add"},null,8,["modelValue"])]),_:1})):b("",!0),y(ve).type!==y(Q).BUTTON?(u(),h(t,{key:9,label:"图标",prop:"icon"},{default:c(()=>[m(Pe,{modelValue:y(ve).icon,"onUpdate:modelValue":l[17]||(l[17]=e=>y(ve).icon=e)},null,8,["modelValue"])]),_:1})):b("",!0),y(ve).type==y(Q).CATALOG?(u(),h(t,{key:10,label:"跳转路由"},{default:c(()=>[m(a,{modelValue:y(ve).redirect,"onUpdate:modelValue":l[18]||(l[18]=e=>y(ve).redirect=e),placeholder:"跳转路由"},null,8,["modelValue"])]),_:1})):b("",!0)]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title","size"])])}}});export{se as default};
