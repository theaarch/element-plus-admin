import{d as e,aG as a,ak as l,r as t,S as o,c as r,aq as s,o as i,bO as d,g as n,f as u,m as p,w as m,i as c,C as f,a3 as g,a4 as _,$ as b,e as j,h as v,F as h,az as y,P as V,Q as w,dK as x,b9 as k}from"./index.DRPoGZBk.js";import{v as U}from"./loading.DIBzycS9.js";import{E as C}from"./overlay.2CFaBIuz.js";import{E as I}from"./switch.CbQZtCc2.js";import{_ as E}from"./index.vue_vue_type_script_setup_true_lang.BWd5rRtr.js";/* empty css            */import{E as z,a as T}from"./select.Dg8cxWuu.js";import"./scrollbar.psmrftie.js";import"./popper.BU17CZ-L.js";import"./tree.C7HEleVO.js";import"./checkbox.HknQRT7E.js";import"./text.B0WblZFB.js";import{E as R}from"./tree-select.C98Oyw_c.js";import{a as S,E as N}from"./col.7XykCHxG.js";import{E as O}from"./card.QxKCHOda.js";import{_ as D}from"./index.DBFSzPNP.js";import{a as q,E as B}from"./table-column.C2ueaBaa.js";/* empty css                */import{_ as F}from"./DictLabel.vue_vue_type_script_setup_true_lang.CIvc-V1Q.js";import{a as A,E as L}from"./form-item.BX728IAv.js";/* empty css               */import{E as P}from"./date-picker-panel.CAlEuNg7.js";import{E as Y}from"./input.CQ-26BBh.js";import{D as K}from"./dept-api.BT8kzwGZ.js";import{R as Z}from"./roles.Ds-Fh_hy.js";import{_ as M}from"./DeptTree.vue_vue_type_script_setup_true_lang.BSu0uK4U.js";import{_ as $}from"./UserImport.vue_vue_type_script_setup_true_lang.BipayrVu.js";/* empty css                    *//* empty css                */import{E as X}from"./index.CATG-Bau.js";import{E as G}from"./index.CjQJJCUT.js";import{E as J}from"./index.B9FqeKvr.js";import{E as Q}from"./index.CHumVb_u.js";import"./vnode.BI5jxDcy.js";import"./index.SISkM0HS.js";import"./aria.Cpd_B0tV.js";import"./refs.Cw5r5QN8.js";import"./event.BwRzfsZt.js";import"./error.D_Dr4eZ1.js";import"./scroll.EvVlGgaK.js";import"./use-form-common-props.DsMPcFL7.js";import"./index.C88r2BaC.js";import"./index.F5OfedVa.js";/* empty css                       */import"./radio-group.DBQ1zoyi.js";import"./token.DWNpOE8r.js";import"./strings.aj8LsXir.js";import"./castArray.DubCdOyv.js";import"./index.cDg2wPYz.js";import"./debounce.DQPPIhOy.js";import"./toNumber.BFSSBEJo.js";import"./_baseIteratee.CeiHmyQH.js";import"./index.CJYjkF3a.js";import"./index.YVQhVyFI.js";import"./index.CfNIqZzg.js";import"./typescript.CRqm1_SZ.js";import"./pagination.HPmRLtz8.js";import"./_plugin-vue_export-helper.BCo6x5W8.js";import"./_initCloneObject.CljjGAhF.js";import"./raf.Rxgr8PiF.js";import"./_baseClone.CEh0Izpu.js";import"./dayjs.min.DqgPjcVY.js";import"./index.CuviTts7.js";import"./index.CQZWqeco.js";import"./alert.D5p8h8Z0.js";import"./upload.PyYNndzD.js";import"./progress.CHZRpn5t.js";import"./link.CM2ZuMlr.js";const W={class:"app-container"},H={class:"search-container"},ee={class:"data-table__toolbar"},ae={class:"data-table__toolbar--actions"},le={class:"data-table__toolbar--tools"},te={class:"dialog-footer"},oe=e({name:"User",inheritAttrs:!1,__name:"Index",setup(e){const oe=a(),re=l(),se=t(),ie=t(),de=o({pageNum:1,pageSize:10}),ne=t(),ue=t(0),pe=t(!1),me=o({visible:!1,title:"新增用户"}),ce=r(()=>re.device===s.DESKTOP?"600px":"90%"),fe=o({status:1}),ge=o({username:[{required:!0,message:"用户名不能为空",trigger:"blur"}],nickname:[{required:!0,message:"用户昵称不能为空",trigger:"blur"}],deptId:[{required:!0,message:"所属部门不能为空",trigger:"blur"}],roleIds:[{required:!0,message:"用户角色不能为空",trigger:"blur"}],email:[{pattern:/\w[-\w.+]*@([A-Za-z0-9][-A-Za-z0-9]+\.)+[A-Za-z]{2,14}/,message:"请输入正确的邮箱地址",trigger:"blur"}],mobile:[{pattern:/^1[3|4|5|6|7|8|9][0-9]\d{8}$/,message:"请输入正确的手机号码",trigger:"blur"}]}),_e=t([]),be=t(),je=t(),ve=t(!1);async function he(){pe.value=!0;try{const e=await k.getPage(de);ne.value=e.list,ue.value=e.total}finally{pe.value=!1}}function ye(){de.pageNum=1,he()}function Ve(){se.value.resetFields(),de.pageNum=1,de.deptId=void 0,de.createTime=void 0,he()}function we(e){_e.value=e.map(e=>e.id)}async function xe(e){me.visible=!0,je.value=await Z.getOptions(),be.value=await K.getOptions(),e?(me.title="修改用户",k.getFormData(e).then(e=>{Object.assign(fe,{...e})})):me.title="新增用户"}function ke(){me.visible=!1,ie.value.resetFields(),ie.value.clearValidate(),fe.id=void 0,fe.status=1}const Ue=x(()=>{ie.value.validate(e=>{if(e){const e=fe.id;pe.value=!0,e?k.update(e,fe).then(()=>{Q.success("修改用户成功"),ke(),Ve()}).finally(()=>pe.value=!1):k.create(fe).then(()=>{Q.success("新增用户成功"),ke(),Ve()}).finally(()=>pe.value=!1)}})},1e3);function Ce(e){const a=[e||_e.value].join(",");if(!a)return void Q.warning("请勾选删除项");const l=oe.userInfo;!function(e,a=[],l){return!!l?.userId&&(!(!e||e.toString()!==l.userId)||!e&&a.length>0&&a.map(String).includes(l.userId))}(e,_e.value,l)?J.confirm("确认删除用户?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{pe.value=!0,k.deleteByIds(a).then(()=>{Q.success("删除成功"),Ve()}).finally(()=>pe.value=!1)},()=>{Q.info("已取消删除")}):Q.error("不能删除当前登录用户")}function Ie(){ve.value=!0}function Ee(){k.export(de).then(e=>{const a=e.data,l=decodeURI(e.headers["content-disposition"].split(";")[1].split("=")[1]),t=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=utf-8"}),o=window.URL.createObjectURL(t),r=document.createElement("a");r.href=o,r.download=l,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(o)})}return i(()=>{ye()}),(e,a)=>{const l=S,t=Y,o=L,r=T,s=z,i=P,x=X,K=A,Z=B,oe=F,re=G,ze=q,Te=D,Re=O,Se=N,Ne=R,Oe=E,De=I,qe=C,Be=d("hasPerm"),Fe=U;return u(),n("div",W,[p(Se,{gutter:20},{default:m(()=>[p(l,{lg:4,xs:24,class:"mb-[12px]"},{default:m(()=>[p(M,{modelValue:c(de).deptId,"onUpdate:modelValue":a[0]||(a[0]=e=>c(de).deptId=e),onNodeClick:ye},null,8,["modelValue"])]),_:1}),p(l,{lg:20,xs:24},{default:m(()=>[f("div",H,[p(K,{ref_key:"queryFormRef",ref:se,model:c(de),inline:!0,"label-width":"auto"},{default:m(()=>[p(o,{label:"关键字",prop:"keywords"},{default:m(()=>[p(t,{modelValue:c(de).keywords,"onUpdate:modelValue":a[1]||(a[1]=e=>c(de).keywords=e),placeholder:"用户名/昵称/手机号",clearable:"",onKeyup:g(ye,["enter"])},null,8,["modelValue"])]),_:1}),p(o,{label:"状态",prop:"status"},{default:m(()=>[p(s,{modelValue:c(de).status,"onUpdate:modelValue":a[2]||(a[2]=e=>c(de).status=e),placeholder:"全部",clearable:"",style:{width:"100px"}},{default:m(()=>[p(r,{label:"正常",value:1}),p(r,{label:"禁用",value:0})]),_:1},8,["modelValue"])]),_:1}),p(o,{label:"创建时间"},{default:m(()=>[p(i,{modelValue:c(de).createTime,"onUpdate:modelValue":a[3]||(a[3]=e=>c(de).createTime=e),editable:!1,type:"daterange","range-separator":"~","start-placeholder":"开始时间","end-placeholder":"截止时间","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),p(o,{class:"search-buttons"},{default:m(()=>[p(x,{type:"primary",icon:"search",onClick:ye},{default:m(()=>[...a[20]||(a[20]=[_("搜索",-1)])]),_:1}),p(x,{icon:"refresh",onClick:Ve},{default:m(()=>[...a[21]||(a[21]=[_("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),p(Re,{shadow:"hover",class:"data-table"},{default:m(()=>[f("div",ee,[f("div",ae,[b((u(),j(x,{type:"success",icon:"plus",onClick:a[4]||(a[4]=e=>xe())},{default:m(()=>[...a[22]||(a[22]=[_(" 新增 ",-1)])]),_:1})),[[Be,["sys:user:add"]]]),b((u(),j(x,{type:"danger",icon:"delete",disabled:0===c(_e).length,onClick:a[5]||(a[5]=e=>Ce())},{default:m(()=>[...a[23]||(a[23]=[_(" 删除 ",-1)])]),_:1},8,["disabled"])),[[Be,"sys:user:delete"]])]),f("div",le,[b((u(),j(x,{icon:"upload",onClick:Ie},{default:m(()=>[...a[24]||(a[24]=[_(" 导入 ",-1)])]),_:1})),[[Be,"sys:user:import"]]),b((u(),j(x,{icon:"download",onClick:Ee},{default:m(()=>[...a[25]||(a[25]=[_(" 导出 ",-1)])]),_:1})),[[Be,"sys:user:export"]])])]),b((u(),j(ze,{data:c(ne),border:"",stripe:"","highlight-current-row":"",class:"data-table__content",onSelectionChange:we},{default:m(()=>[p(Z,{type:"selection",width:"50",align:"center"}),p(Z,{label:"用户名",prop:"username"}),p(Z,{label:"昵称",width:"150",align:"center",prop:"nickname"}),p(Z,{label:"性别",width:"100",align:"center"},{default:m(e=>[p(oe,{modelValue:e.row.gender,"onUpdate:modelValue":a=>e.row.gender=a,code:"gender"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),p(Z,{label:"部门",width:"120",align:"center",prop:"deptName"}),p(Z,{label:"手机号码",align:"center",prop:"mobile",width:"120"}),p(Z,{label:"邮箱",align:"center",prop:"email",width:"160"}),p(Z,{label:"状态",align:"center",prop:"status",width:"80"},{default:m(e=>[p(re,{type:1==e.row.status?"success":"info"},{default:m(()=>[_(h(1==e.row.status?"正常":"禁用"),1)]),_:2},1032,["type"])]),_:1}),p(Z,{label:"创建时间",align:"center",prop:"createTime",width:"150"}),p(Z,{label:"操作",fixed:"right",width:"220"},{default:m(e=>[b((u(),j(x,{type:"primary",icon:"RefreshLeft",size:"small",link:"",onClick:a=>{return l=e.row,void J.prompt("请输入用户【"+l.username+"】的新密码","重置密码",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(({value:e})=>{if(!e||e.length<6)return Q.warning("密码至少需要6位字符，请重新输入"),!1;k.resetPassword(l.id,e).then(()=>{Q.success("密码重置成功，新密码是："+e)})},()=>{Q.info("已取消重置密码")});var l}},{default:m(()=>[...a[26]||(a[26]=[_(" 重置密码 ",-1)])]),_:1},8,["onClick"])),[[Be,"sys:user:reset-password"]]),b((u(),j(x,{type:"primary",icon:"edit",link:"",size:"small",onClick:a=>xe(e.row.id)},{default:m(()=>[...a[27]||(a[27]=[_(" 编辑 ",-1)])]),_:1},8,["onClick"])),[[Be,"sys:user:edit"]]),b((u(),j(x,{type:"danger",icon:"delete",link:"",size:"small",onClick:a=>Ce(e.row.id)},{default:m(()=>[...a[28]||(a[28]=[_(" 删除 ",-1)])]),_:1},8,["onClick"])),[[Be,"sys:user:delete"]])]),_:1})]),_:1},8,["data"])),[[Fe,c(pe)]]),c(ue)>0?(u(),j(Te,{key:0,total:c(ue),"onUpdate:total":a[6]||(a[6]=e=>y(ue)?ue.value=e:null),page:c(de).pageNum,"onUpdate:page":a[7]||(a[7]=e=>c(de).pageNum=e),limit:c(de).pageSize,"onUpdate:limit":a[8]||(a[8]=e=>c(de).pageSize=e),onPagination:he},null,8,["total","page","limit"])):v("",!0)]),_:1})]),_:1})]),_:1}),p(qe,{modelValue:c(me).visible,"onUpdate:modelValue":a[17]||(a[17]=e=>c(me).visible=e),title:c(me).title,"append-to-body":"",size:c(ce),onClose:ke},{footer:m(()=>[f("div",te,[p(x,{type:"primary",onClick:c(Ue)},{default:m(()=>[...a[29]||(a[29]=[_("确 定",-1)])]),_:1},8,["onClick"]),p(x,{onClick:ke},{default:m(()=>[...a[30]||(a[30]=[_("取 消",-1)])]),_:1})])]),default:m(()=>[p(K,{ref_key:"userFormRef",ref:ie,model:c(fe),rules:c(ge),"label-width":"80px"},{default:m(()=>[p(o,{label:"用户名",prop:"username"},{default:m(()=>[p(t,{modelValue:c(fe).username,"onUpdate:modelValue":a[9]||(a[9]=e=>c(fe).username=e),readonly:!!c(fe).id,placeholder:"请输入用户名"},null,8,["modelValue","readonly"])]),_:1}),p(o,{label:"用户昵称",prop:"nickname"},{default:m(()=>[p(t,{modelValue:c(fe).nickname,"onUpdate:modelValue":a[10]||(a[10]=e=>c(fe).nickname=e),placeholder:"请输入用户昵称"},null,8,["modelValue"])]),_:1}),p(o,{label:"所属部门",prop:"deptId"},{default:m(()=>[p(Ne,{modelValue:c(fe).deptId,"onUpdate:modelValue":a[11]||(a[11]=e=>c(fe).deptId=e),placeholder:"请选择所属部门",data:c(be),filterable:"","check-strictly":"","render-after-expand":!1},null,8,["modelValue","data"])]),_:1}),p(o,{label:"性别",prop:"gender"},{default:m(()=>[p(Oe,{modelValue:c(fe).gender,"onUpdate:modelValue":a[12]||(a[12]=e=>c(fe).gender=e),code:"gender"},null,8,["modelValue"])]),_:1}),p(o,{label:"角色",prop:"roleIds"},{default:m(()=>[p(s,{modelValue:c(fe).roleIds,"onUpdate:modelValue":a[13]||(a[13]=e=>c(fe).roleIds=e),multiple:"",placeholder:"请选择"},{default:m(()=>[(u(!0),n(V,null,w(c(je),e=>(u(),j(r,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),p(o,{label:"手机号码",prop:"mobile"},{default:m(()=>[p(t,{modelValue:c(fe).mobile,"onUpdate:modelValue":a[14]||(a[14]=e=>c(fe).mobile=e),placeholder:"请输入手机号码",maxlength:"11"},null,8,["modelValue"])]),_:1}),p(o,{label:"邮箱",prop:"email"},{default:m(()=>[p(t,{modelValue:c(fe).email,"onUpdate:modelValue":a[15]||(a[15]=e=>c(fe).email=e),placeholder:"请输入邮箱",maxlength:"50"},null,8,["modelValue"])]),_:1}),p(o,{label:"状态",prop:"status"},{default:m(()=>[p(De,{modelValue:c(fe).status,"onUpdate:modelValue":a[16]||(a[16]=e=>c(fe).status=e),"inline-prompt":"","active-text":"正常","inactive-text":"禁用","active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title","size"]),p($,{modelValue:c(ve),"onUpdate:modelValue":a[18]||(a[18]=e=>y(ve)?ve.value=e:null),onImportSuccess:a[19]||(a[19]=e=>ye())},null,8,["modelValue"])])}}});export{oe as default};
