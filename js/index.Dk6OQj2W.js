import{d as e,r as l,S as t,o as a,ar as i,bO as o,g as s,f as r,C as n,m as u,w as p,a3 as d,i as m,a4 as c,$ as f,e as b,h as _,F as y,az as v,P as g,Q as h,b9 as j}from"./index.DRPoGZBk.js";import{v as w}from"./loading.DIBzycS9.js";import{E as k,a as V}from"./descriptions-item.CIxzXp3k.js";import{E as x}from"./overlay.2CFaBIuz.js";import{_ as C}from"./index.vue_vue_type_script_setup_true_lang.-KaBqV4M.js";import{E as S,a as U}from"./radio-group.DBQ1zoyi.js";import{_ as T}from"./index.vue_vue_type_script_setup_true_lang.BWd5rRtr.js";import{E}from"./card.QxKCHOda.js";import{_ as N}from"./index.DBFSzPNP.js";import{a as z,E as F}from"./table-column.C2ueaBaa.js";import"./checkbox.HknQRT7E.js";/* empty css                */import"./popper.BU17CZ-L.js";import"./scrollbar.psmrftie.js";/* empty css            */import{_ as O}from"./DictLabel.vue_vue_type_script_setup_true_lang.CIvc-V1Q.js";import{E as q,a as I}from"./form-item.BX728IAv.js";/* empty css               */import{E as P,a as B}from"./select.Dg8cxWuu.js";import{E as D}from"./input.CQ-26BBh.js";import{N as L}from"./notice-api.BKz5MHqD.js";/* empty css                *//* empty css                    */import{E as R}from"./index.CATG-Bau.js";import{E as A}from"./index.CjQJJCUT.js";import{E as H}from"./index.CHumVb_u.js";import{E as K}from"./index.B9FqeKvr.js";import"./vnode.BI5jxDcy.js";import"./use-form-common-props.DsMPcFL7.js";import"./index.SISkM0HS.js";import"./aria.Cpd_B0tV.js";import"./refs.Cw5r5QN8.js";import"./event.BwRzfsZt.js";import"./error.D_Dr4eZ1.js";import"./scroll.EvVlGgaK.js";import"./index.C88r2BaC.js";import"./file-api.DGfbDBKw.js";import"./index.F5OfedVa.js";/* empty css                       */import"./pagination.HPmRLtz8.js";import"./typescript.CRqm1_SZ.js";import"./_plugin-vue_export-helper.BCo6x5W8.js";import"./_initCloneObject.CljjGAhF.js";import"./raf.Rxgr8PiF.js";import"./_baseIteratee.CeiHmyQH.js";import"./castArray.DubCdOyv.js";import"./debounce.DQPPIhOy.js";import"./toNumber.BFSSBEJo.js";import"./index.CJYjkF3a.js";import"./index.YVQhVyFI.js";import"./_baseClone.CEh0Izpu.js";import"./token.DWNpOE8r.js";import"./strings.aj8LsXir.js";import"./index.cDg2wPYz.js";import"./index.CQZWqeco.js";const M={class:"app-container"},Q={class:"search-container"},X={class:"data-table__toolbar"},Y={class:"data-table__toolbar--actions"},$={class:"flex-x-start"},W={key:0,class:"flex-x-start"},Z={key:1,class:"flex-x-start"},G={class:"dialog-footer"},J={class:"flex-x-between"},ee={class:"dialog-toolbar"},le=["innerHTML"],te=e({name:"Notice",inheritAttrs:!1,__name:"index",setup(e){const te=l(),ae=l(),ie=l(!1),oe=l([]),se=l(0),re=t({pageNum:1,pageSize:10}),ne=l([]),ue=l([]),pe=t({title:"",visible:!1}),de=t({level:"L",targetType:1}),me=t({title:[{required:!0,message:"请输入通知标题",trigger:"blur"}],content:[{required:!0,message:"请输入通知内容",trigger:"blur",validator:(e,l,t)=>{l.replace(/<[^>]+>/g,"").trim()?t():t(new Error("请输入通知内容"))}}],type:[{required:!0,message:"请选择通知类型",trigger:"change"}]}),ce=t({visible:!1}),fe=l({});function be(){ie.value=!0,re.pageNum=1,L.getPage(re).then(e=>{ue.value=e.list,se.value=e.total}).finally(()=>{ie.value=!1})}function _e(){te.value.resetFields(),re.pageNum=1,be()}function ye(e){oe.value=e.map(e=>e.id)}function ve(e){j.getOptions().then(e=>{ne.value=e}),pe.visible=!0,e?(pe.title="修改公告",L.getFormData(e).then(e=>{Object.assign(de,e)})):(Object.assign(de,{level:0,targetType:0}),pe.title="新增公告")}function ge(){pe.visible=!1,ae.value.resetFields(),ae.value.clearValidate(),de.id=void 0,de.targetType=1}function he(e){const l=[e||oe.value].join(",");l?K.confirm("确认删除已选中的数据项?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{ie.value=!0,L.deleteByIds(l).then(()=>{H.success("删除成功"),_e()}).finally(()=>ie.value=!1)},()=>{H.info("已取消删除")}):H.warning("请勾选删除项")}const je=()=>{ce.visible=!1};return a(()=>{be()}),(e,l)=>{const t=D,a=q,j=B,K=P,we=R,ke=I,Ve=F,xe=O,Ce=A,Se=z,Ue=N,Te=E,Ee=T,Ne=U,ze=S,Fe=C,Oe=x,qe=i("Close"),Ie=V,Pe=k,Be=o("hasPerm"),De=w;return r(),s("div",M,[n("div",Q,[u(ke,{ref_key:"queryFormRef",ref:te,model:m(re),inline:!0,"label-suffix":":"},{default:p(()=>[u(a,{label:"标题",prop:"title"},{default:p(()=>[u(t,{modelValue:m(re).title,"onUpdate:modelValue":l[0]||(l[0]=e=>m(re).title=e),placeholder:"标题",clearable:"",onKeyup:l[1]||(l[1]=d(e=>be(),["enter"]))},null,8,["modelValue"])]),_:1}),u(a,{label:"发布状态",prop:"publishStatus"},{default:p(()=>[u(K,{modelValue:m(re).publishStatus,"onUpdate:modelValue":l[2]||(l[2]=e=>m(re).publishStatus=e),clearable:"",placeholder:"全部",style:{width:"100px"}},{default:p(()=>[u(j,{value:0,label:"未发布"}),u(j,{value:1,label:"已发布"}),u(j,{value:-1,label:"已撤回"})]),_:1},8,["modelValue"])]),_:1}),u(a,{class:"search-buttons"},{default:p(()=>[u(we,{type:"primary",icon:"search",onClick:l[3]||(l[3]=e=>be())},{default:p(()=>[...l[21]||(l[21]=[c("搜索",-1)])]),_:1}),u(we,{icon:"refresh",onClick:l[4]||(l[4]=e=>_e())},{default:p(()=>[...l[22]||(l[22]=[c("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),u(Te,{shadow:"hover",class:"data-table"},{default:p(()=>[n("div",X,[n("div",Y,[f((r(),b(we,{type:"success",icon:"plus",onClick:l[5]||(l[5]=e=>ve())},{default:p(()=>[...l[23]||(l[23]=[c(" 新增通知 ",-1)])]),_:1})),[[Be,["sys:notice:add"]]]),f((r(),b(we,{type:"danger",disabled:0===m(oe).length,icon:"delete",onClick:l[6]||(l[6]=e=>he())},{default:p(()=>[...l[24]||(l[24]=[c(" 删除 ",-1)])]),_:1},8,["disabled"])),[[Be,["sys:notice:delete"]]])])]),f((r(),b(Se,{ref:"dataTableRef",data:m(ue),"highlight-current-row":"",class:"data-table__content",onSelectionChange:ye},{default:p(()=>[u(Ve,{type:"selection",width:"55",align:"center"}),u(Ve,{type:"index",label:"序号",width:"60"}),u(Ve,{label:"通知标题",prop:"title","min-width":"200"}),u(Ve,{align:"center",label:"通知类型",width:"150"},{default:p(e=>[u(xe,{modelValue:e.row.type,"onUpdate:modelValue":l=>e.row.type=l,code:"notice_type"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),u(Ve,{align:"center",label:"发布人",prop:"publisherName",width:"150"}),u(Ve,{align:"center",label:"通知等级",width:"100"},{default:p(e=>[u(xe,{modelValue:e.row.level,"onUpdate:modelValue":l=>e.row.level=l,code:"notice_level"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),u(Ve,{align:"center",label:"通告目标类型",prop:"targetType","min-width":"100"},{default:p(e=>[1==e.row.targetType?(r(),b(Ce,{key:0,type:"warning"},{default:p(()=>[...l[25]||(l[25]=[c("全体",-1)])]),_:1})):_("",!0),2==e.row.targetType?(r(),b(Ce,{key:1,type:"success"},{default:p(()=>[...l[26]||(l[26]=[c("指定",-1)])]),_:1})):_("",!0)]),_:1}),u(Ve,{align:"center",label:"发布状态","min-width":"100"},{default:p(e=>[0==e.row.publishStatus?(r(),b(Ce,{key:0,type:"info"},{default:p(()=>[...l[27]||(l[27]=[c("未发布",-1)])]),_:1})):_("",!0),1==e.row.publishStatus?(r(),b(Ce,{key:1,type:"success"},{default:p(()=>[...l[28]||(l[28]=[c("已发布",-1)])]),_:1})):_("",!0),-1==e.row.publishStatus?(r(),b(Ce,{key:2,type:"warning"},{default:p(()=>[...l[29]||(l[29]=[c("已撤回",-1)])]),_:1})):_("",!0)]),_:1}),u(Ve,{label:"操作时间",width:"250"},{default:p(e=>[n("div",$,[l[30]||(l[30]=n("span",null,"创建时间：",-1)),n("span",null,y(e.row.createTime||"-"),1)]),1===e.row.publishStatus?(r(),s("div",W,[l[31]||(l[31]=n("span",null,"发布时间：",-1)),n("span",null,y(e.row.publishTime||"-"),1)])):-1===e.row.publishStatus?(r(),s("div",Z,[l[32]||(l[32]=n("span",null,"撤回时间：",-1)),n("span",null,y(e.row.revokeTime||"-"),1)])):_("",!0)]),_:1}),u(Ve,{align:"center",fixed:"right",label:"操作",width:"150"},{default:p(e=>[u(we,{type:"primary",size:"small",link:"",onClick:l=>(async e=>{const l=await L.getDetail(e);fe.value=l,ce.visible=!0})(e.row.id)},{default:p(()=>[...l[33]||(l[33]=[c(" 查看 ",-1)])]),_:1},8,["onClick"]),1!=e.row.publishStatus?f((r(),b(we,{key:0,type:"primary",size:"small",link:"",onClick:l=>{return t=e.row.id,void L.publish(t).then(()=>{H.success("发布成功"),be()});var t}},{default:p(()=>[...l[34]||(l[34]=[c(" 发布 ",-1)])]),_:1},8,["onClick"])),[[Be,["sys:notice:publish"]]]):_("",!0),1==e.row.publishStatus?f((r(),b(we,{key:1,type:"primary",size:"small",link:"",onClick:l=>{return t=e.row.id,void L.revoke(t).then(()=>{H.success("撤回成功"),be()});var t}},{default:p(()=>[...l[35]||(l[35]=[c(" 撤回 ",-1)])]),_:1},8,["onClick"])),[[Be,["sys:notice:revoke"]]]):_("",!0),1!=e.row.publishStatus?f((r(),b(we,{key:2,type:"primary",size:"small",link:"",onClick:l=>ve(e.row.id)},{default:p(()=>[...l[36]||(l[36]=[c(" 编辑 ",-1)])]),_:1},8,["onClick"])),[[Be,["sys:notice:edit"]]]):_("",!0),1!=e.row.publishStatus?f((r(),b(we,{key:3,type:"danger",size:"small",link:"",onClick:l=>he(e.row.id)},{default:p(()=>[...l[37]||(l[37]=[c(" 删除 ",-1)])]),_:1},8,["onClick"])),[[Be,["sys:notice:delete"]]]):_("",!0)]),_:1})]),_:1},8,["data"])),[[De,m(ie)]]),m(se)>0?(r(),b(Ue,{key:0,total:m(se),"onUpdate:total":l[7]||(l[7]=e=>v(se)?se.value=e:null),page:m(re).pageNum,"onUpdate:page":l[8]||(l[8]=e=>m(re).pageNum=e),limit:m(re).pageSize,"onUpdate:limit":l[9]||(l[9]=e=>m(re).pageSize=e),onPagination:l[10]||(l[10]=e=>be())},null,8,["total","page","limit"])):_("",!0)]),_:1}),u(Oe,{modelValue:m(pe).visible,"onUpdate:modelValue":l[19]||(l[19]=e=>m(pe).visible=e),title:m(pe).title,top:"3vh",width:"80%",onClose:ge},{footer:p(()=>[n("div",G,[u(we,{type:"primary",onClick:l[17]||(l[17]=e=>{ae.value.validate(e=>{if(e){ie.value=!0;const e=de.id;e?L.update(e,de).then(()=>{H.success("修改成功"),ge(),_e()}).finally(()=>ie.value=!1):L.create(de).then(()=>{H.success("新增成功"),ge(),_e()}).finally(()=>ie.value=!1)}})})},{default:p(()=>[...l[40]||(l[40]=[c("确定",-1)])]),_:1}),u(we,{onClick:l[18]||(l[18]=e=>ge())},{default:p(()=>[...l[41]||(l[41]=[c("取消",-1)])]),_:1})])]),default:p(()=>[u(ke,{ref_key:"dataFormRef",ref:ae,model:m(de),rules:m(me),"label-width":"100px"},{default:p(()=>[u(a,{label:"通知标题",prop:"title"},{default:p(()=>[u(t,{modelValue:m(de).title,"onUpdate:modelValue":l[11]||(l[11]=e=>m(de).title=e),placeholder:"通知标题",clearable:""},null,8,["modelValue"])]),_:1}),u(a,{label:"通知类型",prop:"type"},{default:p(()=>[u(Ee,{modelValue:m(de).type,"onUpdate:modelValue":l[12]||(l[12]=e=>m(de).type=e),code:"notice_type"},null,8,["modelValue"])]),_:1}),u(a,{label:"通知等级",prop:"level"},{default:p(()=>[u(Ee,{modelValue:m(de).level,"onUpdate:modelValue":l[13]||(l[13]=e=>m(de).level=e),code:"notice_level"},null,8,["modelValue"])]),_:1}),u(a,{label:"目标类型",prop:"targetType"},{default:p(()=>[u(ze,{modelValue:m(de).targetType,"onUpdate:modelValue":l[14]||(l[14]=e=>m(de).targetType=e)},{default:p(()=>[u(Ne,{value:1},{default:p(()=>[...l[38]||(l[38]=[c("全体",-1)])]),_:1}),u(Ne,{value:2},{default:p(()=>[...l[39]||(l[39]=[c("指定",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),2==m(de).targetType?(r(),b(a,{key:0,label:"指定用户",prop:"targetUserIds"},{default:p(()=>[u(K,{modelValue:m(de).targetUserIds,"onUpdate:modelValue":l[15]||(l[15]=e=>m(de).targetUserIds=e),multiple:"",search:"",placeholder:"请选择指定用户"},{default:p(()=>[(r(!0),s(g,null,h(m(ne),e=>(r(),b(j,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):_("",!0),u(a,{label:"通知内容",prop:"content"},{default:p(()=>[u(Fe,{modelValue:m(de).content,"onUpdate:modelValue":l[16]||(l[16]=e=>m(de).content=e)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),u(Oe,{modelValue:m(ce).visible,"onUpdate:modelValue":l[20]||(l[20]=e=>m(ce).visible=e),"show-close":!1,width:"50%","append-to-body":"",onClose:je},{header:p(()=>[n("div",J,[l[42]||(l[42]=n("span",null,"通知公告详情",-1)),n("div",ee,[u(we,{circle:"",onClick:je},{icon:p(()=>[u(qe)]),_:1})])])]),default:p(()=>[u(Pe,{column:1},{default:p(()=>[u(Ie,{label:"标题："},{default:p(()=>[c(y(m(fe).title),1)]),_:1}),u(Ie,{label:"发布状态："},{default:p(()=>[0==m(fe).publishStatus?(r(),b(Ce,{key:0,type:"info"},{default:p(()=>[...l[43]||(l[43]=[c("未发布",-1)])]),_:1})):1==m(fe).publishStatus?(r(),b(Ce,{key:1,type:"success"},{default:p(()=>[...l[44]||(l[44]=[c("已发布",-1)])]),_:1})):-1==m(fe).publishStatus?(r(),b(Ce,{key:2,type:"warning"},{default:p(()=>[...l[45]||(l[45]=[c("已撤回",-1)])]),_:1})):_("",!0)]),_:1}),u(Ie,{label:"发布人："},{default:p(()=>[c(y(m(fe).publisherName),1)]),_:1}),u(Ie,{label:"发布时间："},{default:p(()=>[c(y(m(fe).publishTime),1)]),_:1}),u(Ie,{label:"公告内容："},{default:p(()=>[n("div",{class:"notice-content",innerHTML:m(fe).content},null,8,le)]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}});export{te as default};
